Fos.newConsign=function(f,a,b){var e="";if(a==BT_G){e=SR_CUDE}else{if(a==BT_I){e=SR_INSP}}var d=GGUID();var g=new FConsign({id:d,consId:d,consNotifyParty:"SAME AS CONSIGNEE",consNo:"N"+d,consType:"A",consShipType:b,consActionType:"A",consMasterFlag:b=="LCL"?1:0,consBizClass:f,consBizType:a,consSource:0,consOperatorId:"",consDate:new Date(),tranId:b=="LCL"?CFS:CY,consServiceRequired:e,version:0,consStatus:0,consStatusBooking:0,consStatusClearance:0,consStatusSwitchBl:0,consStatusSplit:0,consStatusInsp:0,consStatusCont:0,consStatusCarg:0,consStatusMbl:0,consStatusHbl:0,consStatusBBook:0,consStatusDepa:0,consStatusDocs:0,consStatusExp:0,consStatusAr:0,consStatusAp:0,consStatusInvoR:0,consStatusInvoP:0,consStatusAud:0,consStatusReassign:0,consStatusInCy:0,consStatusInCfs:0,consStatusOnBoard:0,consStatusEir:0,consStatusSendCont:0,consStatusLock:0,consReassignFrom:0,consStatusSettlement:0,consExternalFlag:0,consTransFlag:0,consPartialFlag:0,consPol:f==BC_E?getCFG("BASE_PORT"):"",consPolEn:f==BC_E?getCFGD("BASE_PORT"):"",consPod:f==BC_I?getCFG("BASE_PORT"):"",consPodEn:f==BC_I?getCFGD("BASE_PORT"):"",deptId:getCFG("DEFAULT_DEPT_"+a),consOperatorId:CUSER_ID,consOperatorName:CUSER_NAME,consFumigateFlag:0,consQuarantineFlag:0,consTransferringFlag:0,rowAction:"N"});return g};Fos.copyConsign=function(g){var h=new FConsign({});var d=GGUID();var e=FConsign.prototype.fields;for(var a=0;a<e.keys.length;a++){var b=""+e.keys[a];h.set(b,g.get(b))}h.set("consDate",new Date());h.set("consId",d);h.set("id",d);h.set("consNo","N"+d);h.set("version",1);h.set("consStatus",0);h.set("consStatusBooking",0);h.set("consStatusClearance",0);h.set("consStatusSwitchBl",0);h.set("consStatusSplit",0);h.set("consStatusInsp",0);h.set("consStatusCont",0);h.set("consStatusCarg",0);h.set("consStatusMbl",0);h.set("consStatusHbl",0);h.set("consStatusBBook",0);h.set("consStatusDepa",0);h.set("consStatusDocs",0);h.set("consStatusExp",0);h.set("consStatusAud",0);h.set("consStatusAr",0);h.set("consStatusAp",0);h.set("consStatusInvoR",0);h.set("consStatusInvoP",0);h.set("consStatusReassign",0);h.set("consStatusInCy",0);h.set("consStatusInCfs",0);h.set("consStatusOnBoard",0);h.set("consStatusEir",0);h.set("consStatusSendCont",0);h.set("consReassignFrom",0);h.set("consStatusLock",0);h.set("consStatusSettlement",0);h.set("rowAction","N");h.set("fconId","");h.set("loliId","");h.set("consMasterFlag","0");h.set("consMasterId","");h.set("consMergeFlag",0);h.set("consMergeId","");h.set("consMergeNo","");return h};Fos.showConsign=function(b){var a=T_MAIN.getComponent("C_"+b.get("id"));if(a){T_MAIN.setActiveTab(a)}else{a=new Fos.ConsignTab(b);T_MAIN.add(a);T_MAIN.setActiveTab(a)}};Fos.showConsignTabs=function(b){var a=T_MAIN.getComponent("C_"+b.get("id"));if(b.get("rowAction")!="N"){if(!a.getComponent("T_DOC_"+b.get("id"))){a.add(new Fos.ConsDocGrid(b))}if(!a.getComponent("T_EXPE_"+b.get("id"))){a.add(VERSION==1?(new Fos.ExpenseTab2(b,"C")):(new Fos.ExpenseTab(b,"C")))}}if(!a.getComponent("T_TRAN_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_TRAN)!=-1){a.add(new Fos.TransTab(b))}if(!a.getComponent("T_WARE_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_WARE)!=-1){a.add(new Fos.WarehouseTab(b))}if(!a.getComponent("T_CONT_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_CONT)!=-1&&(b.get("consShipType")==ST_F||(b.get("consShipType")==ST_L&&b.get("consMasterFlag")=="1"))){a.add(new Fos.ContainerTab(b))}if(!a.getComponent("T_BL_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_BL)!=-1){a.add(new Fos.BLTab(b))}if(!a.getComponent("T_INSP_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_INSP)!=-1){a.add(new Fos.InspectionTab(b))}if(!a.getComponent("T_CUDE_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_CUDE)!=-1){a.add(new Fos.CustomsTab(b))}if(!a.getComponent("T_SPLIT_"+b.get("id"))&&b.get("consBizClass")==BC_I&&b.get("consShipType")==ST_L){a.add(new Fos.SplitTab(b))}if(!a.getComponent("T_BBOOK_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_BBOOK)!=-1){a.add(new Fos.BBookingTab(b))}if(!a.getComponent("T_RABL_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_RABL)!=-1){a.add(new Fos.RailwayBlTab(b))}if(!a.getComponent("T_SESH_"+b.get("id"))&&b.get("consServiceRequired").indexOf(SR_SESH)!=-1){a.add(new Fos.SecondShipTab(b))}};Fos.ConsignGrid=function(ac,ab,Q,X){var ag=[];ag[ag.length]={key:"consBizClass",value:ac,op:1};ag[ag.length]={key:"consBizType",value:ab,op:1};ag[ag.length]={key:"consExternalFlag",value:X?X:"0",op:1};if(Q!=""){ag[ag.length]={key:"consShipType",value:Q,op:1}}var Z={mt:"JSON",xml:Ext.util.JSON.encode(FOSJ(QTJ(ag)))};var e=new Ext.data.GroupingStore({url:SERVICE_URL+"?A=CONS_X",baseParams:Z,reader:new Ext.data.JsonReader({totalProperty:"rowCount",root:"FConsign"},FConsign),remoteSort:true,sortInfo:{field:((ac==BC_E&&Q==ST_L)||ab==BT_B)?"consMasterNo":"consDate",direction:"DESC"}});this.reset=function(){e.baseParams=Z;e.reload({params:{start:0,limit:C_PS}})};var s=new Ext.grid.RowSelectionModel({singleSelect:true});var q=new Ext.grid.RowNumberer();var p={header:"",dataIndex:"consStatusLock",menuDisabled:true,fixed:true,width:25,renderer:function(a){if(a==1){return'<div class="locked"></div>'}else{return""}}};var o={header:C_M_CONS,width:30,hidden:Q!=ST_L,dataIndex:"consMasterFlag",renderer:boolRender};var l={header:C_STATUS,width:60,dataIndex:"consStatus",renderer:ac==BC_E?getCOST:getCIST};var k={header:C_CONS_NO,width:120,dataIndex:"consNo"};var j={header:ab==BT_B?C_CHARTER:C_BOOKER,width:200,dataIndex:"custName"};var i={header:C_CONS_DATE,width:70,dataIndex:"consDate",renderer:formatDate};var h={header:C_TTER,dataIndex:"tranId",width:60,renderer:getTRAN};var g={header:C_PATE,dataIndex:"pateId",width:40,renderer:getPATE};var f={header:C_SHIP_TYPE,dataIndex:"consShipType",width:40};var d={header:C_VESS,width:100,dataIndex:"vessName"};var c={header:ab==BT_A?C_FLIGHT:C_VOYA,width:80,dataIndex:"voyaName"};var b={header:C_SAIL_DATE,dataIndex:"consEtd",renderer:formatDate};var aj={header:C_POL,dataIndex:"consPolEn"};var ai={header:C_POD,width:100,dataIndex:"consPodEn"};var ah={header:ab==BT_A?"MAWB No.":C_MBL_NO,width:80,dataIndex:"consMblNo"};var af={header:ab==BT_A?"HAWB No.":C_HBL_NO,width:80,dataIndex:"consHblNo"};var ae={header:C_PACKAGES,width:80,dataIndex:"consTotalPackages",align:"right",css:"font-weight:bold;"};var ad={header:C_GW,width:80,dataIndex:"consTotalGrossWeight",renderer:rateRender,align:"right",css:"font-weight:bold;"};var W={header:C_CBM,width:80,dataIndex:"consTotalMeasurement",renderer:rateRender,align:"right",css:"font-weight:bold;"};var V={header:C_CONT_INFO,width:80,dataIndex:"consContainersInfo"};var U={header:C_CONT_NUM,width:80,dataIndex:"consTotalContainers",align:"right",renderer:function(a){return(a)?a:0},css:"font-weight:bold;"};var T={header:C_POT,dataIndex:"consPotEn"};var S={header:C_CARRIER,dataIndex:"consCarrierName"};var R={header:C_BOOK_AGENCY,dataIndex:"consBookingAgencyName"};var P={header:C_M_CONS_NO,width:120,hidden:Q!=ST_L,dataIndex:"consMasterNo"};var O={header:C_REMARKS,dataIndex:"consRemarks"};var N={header:C_CONTRACT_NO,dataIndex:"consContractNo"};var M={header:C_CARGO_OWNER,width:200,dataIndex:"consCargoOwnerName"};var z={header:C_BL_PACKAGES,width:80,dataIndex:"blCargoPackages",align:"right",css:"font-weight:bold;"};var y={header:C_BL_GW,width:80,dataIndex:"blCargoGrossWeight",renderer:rateRender,align:"right",css:"font-weight:bold;"};var w={header:C_BL_CBM,width:80,dataIndex:"blCargoMeasurement",renderer:rateRender,align:"right",css:"font-weight:bold;"};var v={header:C_SHIPPED_GW,width:80,dataIndex:"consShippedGrossWeight",renderer:rateRender,align:"right",css:"font-weight:bold;"};var u={header:C_SHIPPED_MEASUREMENT,width:80,dataIndex:"consShippedMeasurement",renderer:rateRender,align:"right",css:"font-weight:bold;"};var t={header:C_OPERATOR,width:80,dataIndex:"consOperatorName"};var r={header:C_ETA,dataIndex:"consEta",renderer:formatDate};var K=new Ext.grid.ColumnModel({columns:ab==BT_B?[q,p,o,l,k,N,t,j,M,i,h,g,f,d,c,b,r,aj,ai,ah,af,ae,ad,W,z,y,w,v,u,T,S,R,P,O]:[q,p,o,l,t,k,j,i,h,g,f,d,c,b,r,aj,ai,ah,af,ae,ad,W,V,U,T,S,R,P,O,N],defaults:{sortable:true}});this.addConsign=function(){var m=s.getSelected();if(m.get("consMasterFlag")=="1"){var a=Fos.newConsign(ac,ab,Q);a.set("consMasterFlag","0");a.set("consMasterId",m.get("consId"));a.set("consMasterNo",m.get("consNo"));a.set("vessId",m.get("vessId"));a.set("vessName",m.get("vessName"));a.set("voyaId",m.get("voyaId"));a.set("voyaName",m.get("voyaName"));a.set("consPol",m.get("consPol"));a.set("consPolName",m.get("consPolName"));a.set("consPod",m.get("consPod"));a.set("consPodName",m.get("consPodName"));a.set("consPot",m.get("consPot"));a.set("consPotName",m.get("consPotName"));a.set("consTranCountry",m.get("consTranCountry"));a.set("consTradeCountry",m.get("consTradeCountry"));a.set("consOverseaAgency",m.get("consOverseaAgency"));a.set("consOverseaAgencyName",m.get("consOverseaAgencyName"));a.set("consHarbour",m.get("consHarbour"));a.set("consCfs",m.get("consCfs"));a.set("consCfsName",m.get("consCfsName"));a.set("consBookingAgency",m.get("consBookingAgency"));a.set("consBookingAgencyName",m.get("consBookingAgencyName"));a.set("consCarrier",m.get("consCarrier"));a.set("consCarrierName",m.get("consCarrierName"));a.set("consExternalFlag",X?X:0);Fos.showConsign(a)}else{XMG.alert(SYS,M_SEL_M_CONS)}};this.newConsign=function(){var a=Fos.newConsign(ac,ab,Q);a.set("consExternalFlag",X?X:"0");Fos.showConsign(a)};this.editConsign=function(){var a=s.getSelected();if(a){Fos.showConsign(a)}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.task=function(){var a=s.getSelected();if(a){var m=new Fos.TaskWin(a);m.show()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.removeConsign=function(){var m=s.getSelections();if(m.length){XMG.confirm(SYS,M_R_C,function(am){if(am=="yes"){var a=false;for(var al=0;al<m.length;al++){if(m[al].get("consStatus")!="0"){a=true;break}}if(a){XMG.alert(SYS,M_CONS_CONFIRMED)}else{var ak=SMTX4R(s,"FConsign","consId");Ext.Ajax.request({url:SERVICE_URL,method:"POST",params:{A:"CONS_S"},success:function(){s.each(function(an){e.remove(an)});XMG.alert(SYS,M_S)},failure:function(an,ao){XMG.alert(SYS,M_F+an.responseText)},xmlData:FOSX(ak)})}}})}else{XMG.alert(SYS,M_R_P)}};this.search=function(){var a=new Fos.ConsLookupWin(ac,ab,Q,"CONS_X",e);a.show()};var J={rowdblclick:function(a,al,m){var ak=a.getSelectionModel().getSelected();if(ak){Fos.showConsign(ak)}},render:function(m){var ak=m.getView().el.dom.childNodes[0].childNodes[1];var a=new Ext.dd.DropTarget(ak,{ddGroup:"consGridDDGroup",copy:false,notifyDrop:function(ar,aq,ap){var am=m.getStore().getById(ap.selections[0].id);var an=Ext.lib.Event.getTarget(aq);var al=m.getView().findRowIndex(an);var ao=m.getStore().getAt(al);if(ao.get("consMasterFlag")!="1"||am.get("consMasterId")==ao.get("consId")){return false}var an=new Ext.Template(M_LCL_TRANS);var at=an.apply([am.get("consNo"),ao.get("consNo")]);Ext.Msg.confirm(SYS,at,function(au){if(au=="yes"){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONS_MNO_U",consMasterFlag:0,consMasterId:ao.get("consId"),consMasterNo:ao.get("consNo"),consId:am.get("consId")},success:function(av){e.reload(e.lastOptions);XMG.alert(SYS,M_S);return true},failure:function(av){XMG.alert(SYS,M_F+av.responseText);return false}})}else{return false}})}})}};var Y=new Ext.form.TextField({listeners:{scope:this,specialkey:function(m,a){if(a.getKey()==Ext.EventObject.ENTER){this.fastSearch()}}}});this.fastSearch=function(){var an=Y.getValue();if(!an){XMG.alert(SYS,M_INPUT_BIZ_NO,function(a){Y.focus()});return}var ak=[];ak[ak.length]={key:"consBizClass",value:ac,op:EQ};ak[ak.length]={key:"consBizType",value:ab,op:EQ};if(Q!=""){ak[ak.length]={key:"consShipType",value:Q,op:EQ}}ak[ak.length]={key:"consExternalFlag",value:X?X:"0",op:1};var am=an.indexOf(",");var m=an.indexOf("..");if(am>=0){ak[ak.length]={key:"consNo",value:an,op:IN}}else{if(m>=0){var al=an.split("..");ak[ak.length]={key:"consNo",value:al[0],op:GE};ak[ak.length]={key:"consNo",value:al[1],op:LE}}else{ak[ak.length]={key:"consNo",value:an,op:LI}}}e.baseParams={mt:"JSON",xml:Ext.util.JSON.encode(FOSJ(QTJ(ak)))};e.reload({params:{start:0,limit:C_PS},callback:function(a){if(a.length==0){XMG.alert(SYS,M_NOT_FOUND)}}})};this.exp=function(){EXP("C","CONS_LIST",e.baseParams.xml?"&mt=JSON&xml="+Ext.util.JSON.encode(e.baseParams.xml):"&mt=JSON")};var L=getBT(ab);L+=getBC(ac);if(ac==BC_I&&Q=="LCL"){L+=C_SWITCH}else{L+=getSHTY(Q)}L+=C_CONS_LIST;var aa=getRM(ac,ab,Q)+M3_CONS;var I={text:C_ADD+"(N)",disabled:NR(aa+(ab==BT_B?F_CM:F_M))||(ab==BT_C&&Q==""),iconCls:"add",handler:this.newConsign};var H={text:C_CONSOLIDATE+"(P)",disabled:NR(aa+F_M),iconCls:"add",handler:this.addConsign};var G={text:C_EDIT+"(M)",disabled:NR(aa+F_V),iconCls:"option",handler:this.editConsign};var F={text:C_REMOVE+"(D)",disabled:NR(aa+F_R),iconCls:"remove",handler:this.removeConsign};var E={text:C_SEARCH+"(F)",iconCls:"search",handler:this.search};var D={text:C_EXPORT+"(E)",disabled:NR(aa+F_E),iconCls:"print",handler:this.exp};var C=new Ext.PagingToolbar({pageSize:C_PS,store:e});var B={text:C_FAST_SEARCH+"(Q)",iconCls:"search",handler:this.fastSearch};var A={text:C_RESET+"(F5)",iconCls:"refresh",handler:this.reset};var n={text:C_TASK+"(T)",iconCls:"task",handler:this.task};new Ext.KeyMap(Ext.getDoc(),{key:"nmdfeq",ctrl:true,handler:function(a,ak){var m=T_MAIN.getComponent("G_CONS_"+ac+"_"+ab+(Q==""?"":"_"+Q)+(X?"_"+X:""));if(m&&m==T_MAIN.getActiveTab()){switch(a){case Ext.EventObject.N:this.newConsign();break;case Ext.EventObject.M:this.editConsign();break;case Ext.EventObject.D:this.removeConsign();break;case Ext.EventObject.F:this.search();break;case Ext.EventObject.E:this.exp();break;case Ext.EventObject.Q:this.fastSearch();break}}},stopEvent:true,scope:this});new Ext.KeyMap(Ext.getDoc(),{key:[116],handler:function(a,ak){var m=T_MAIN.getComponent("G_CONS_"+ac+"_"+ab+(Q==""?"":"_"+Q)+(X?"_"+X:""));if(m&&m==T_MAIN.getActiveTab()){switch(a){case Ext.EventObject.F5:this.reset();break}}},stopEvent:true,scope:this});this.pagingNav=function(m){var a=T_MAIN.getComponent("G_CONS_"+ac+"_"+ab+(Q==""?"":"_"+Q)+(X?"_"+X:""));if(a&&a==T_MAIN.getActiveTab()){var ak=this.getBottomToolbar();if(!ak[m].disabled){ak.onClick(m)}}};this.nav=new Ext.KeyNav(Ext.getDoc(),{pageDown:this.pagingNav.createDelegate(this,["next"]),pageUp:this.pagingNav.createDelegate(this,["prev"]),home:this.pagingNav.createDelegate(this,["first"]),end:this.pagingNav.createDelegate(this,["last"]),scope:this});var x=[I,"-",G,"-",F,"-",E,"-",D,"-",Y,B,"-",A,"-",n,"-"];if(ab==BT_B){x=[I,"-",G,"-",F,"-",E,"-",D,"-",Y,B,"-",A,"-",n,"-"]}else{if(ab==BT_C&&ac==BC_E&&Q==ST_L){x=[I,"-",H,"-",G,"-",F,"-",E,"-",D,"-",Y,B,"-",A,"-",n,"-"]}}Fos.ConsignGrid.superclass.constructor.call(this,{id:"G_CONS_"+ac+"_"+ab+(Q==""?"":"_"+Q)+(X?"_"+X:""),iconCls:"grid",store:e,title:L,header:false,loadMask:true,sm:s,cm:K,stripeRows:true,closable:true,ddGroup:"consGridDDGroup",enableDragDrop:Q=="LCL"?true:false,listeners:J,view:new Ext.grid.GroupingView(groupViewCfg),tbar:x,bbar:PTB(e,C_PS)});e.load({params:{start:0,limit:C_PS}})};Ext.extend(Fos.ConsignGrid,Ext.grid.GridPanel);Fos.ConsignTab=function(b){var a=[];a[0]=new Fos.BookTab(b);if(b.get("rowAction")!="N"){a[a.length]=new Fos.ConsDocGrid(b);a[a.length]=VERSION==1?(new Fos.ExpenseTab2(b,"C")):(new Fos.ExpenseTab(b,"C"))}if(b.get("consServiceRequired").indexOf(SR_TRAN)!=-1){a[a.length]=new Fos.TransTab(b)}if(b.get("consServiceRequired").indexOf(SR_WARE)!=-1){a[a.length]=new Fos.WarehouseTab(b)}if(b.get("consServiceRequired").indexOf(SR_CONT)!=-1&&(b.get("consShipType")==ST_F||(b.get("consShipType")==ST_L&&b.get("consMasterFlag")=="1"))){a[a.length]=new Fos.ContainerTab(b)}if(b.get("consServiceRequired").indexOf(SR_BL)!=-1){a[a.length]=new Fos.BLTab(b)}if(b.get("consServiceRequired").indexOf(SR_INSP)!=-1){a[a.length]=new Fos.InspectionTab(b)}if(b.get("consServiceRequired").indexOf(SR_CUDE)!=-1){a[a.length]=new Fos.CustomsTab(b)}if(b.get("consServiceRequired").indexOf(SR_BBOOK)!=-1){a[a.length]=new Fos.BBookingTab(b)}if(b.get("consServiceRequired").indexOf(SR_SESH)!=-1){a[a.length]=new Fos.SecondShipTab(b)}if(b.get("consServiceRequired").indexOf(SR_RABL)!=-1){a[a.length]=new Fos.RailwayBlTab(b)}if(b.get("consBizClass")==BC_I&&b.get("consShipType")==ST_L){a[a.length]=new Fos.SplitTab(b)}new Ext.KeyMap(Ext.getDoc(),{key:[112,113,114,115,116,117,118,119,120,121,122,123],handler:function(f,i){var d=T_MAIN.getComponent("C_"+b.get("id"));if(d==T_MAIN.getActiveTab()){switch(f){case Ext.EventObject.F1:var g=d.getComponent("T_BOOK_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F2:var g=d.getComponent("T_DOC_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F3:var g=d.getComponent("T_EXPE_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F4:var g=d.getComponent("T_TRAN_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F5:var g=d.getComponent("T_WARE_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F6:var g=d.getComponent("T_CONT_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F7:var g=d.getComponent("T_BL_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F8:var g=d.getComponent("T_INSP_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F9:var g=d.getComponent("T_CUDE_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F10:var h=d.getComponent("T_SPLIT_"+b.get("id"));if(h){d.setActiveTab(h)}var g=d.getComponent("T_BBOOK_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F11:var g=d.getComponent("T_SESH_"+b.get("id"));if(g){d.setActiveTab(g)}break;case Ext.EventObject.F12:var g=d.getComponent("T_RABL_"+b.get("id"));if(g){d.setActiveTab(g)}break}}},stopEvent:true});var c=getBT(b.get("consBizType"));c+=getBC(b.get("consBizClass"));if(b.get("consBizType")==BT_C){if(b.get("consBizClass")==BC_I&&b.get("consShipType")=="LCL"){c+=C_SWITCH}else{c+=getSHTY(b.get("consShipType"))}}c+=C_CONSIGN+"-"+b.get("consNo");Fos.ConsignTab.superclass.constructor.call(this,{id:"C_"+b.get("id"),items:a,title:c,iconCls:"class",deferredRender:false,closable:true,activeTab:0,bbar:getMB(b),listeners:{scope:this,tabchange:function(d,e){e.doLayout()}}})};Ext.extend(Fos.ConsignTab,Ext.TabPanel);Fos.BookTab=function(bX){this.carg_s=GS("CARG_Q","FCargo",FCargo,"cargId","ASC");this.cargoGrid=new Fos.CargoGrid(bX,this.carg_s,this);if(bX.get("consBizType")==BT_C){this.cont_s=GS("CONT_Q","FContainer",FContainer,"contId","ASC");this.contGrid=new Fos.ContainerGrid(bX,this.cont_s);if(bX.get("consBizClass")==BC_I){this.hbl_s=GS("BL_Q","FBl",FBl,"blId","ASC");this.hblGrid=new Fos.ImpHblGrid(bX,this.hbl_s)}}if(bX.get("rowAction")!="N"){this.carg_s.load({params:{consId:bX.get("consId")}});if(bX.get("consBizType")==BT_C){this.cont_s.load({params:{consId:bX.get("consId"),contPreFlag:bX.get("consBizClass")==BC_I?"N":"Y"}});if(bX.get("consBizClass")==BC_I){this.hbl_s.load({params:{consId:bX.get("consId"),blType:"H/BL"}})}}}this.save=function(){if(this.find("name","custName")[0].getValue()==""){XMG.alert(SYS,M_CUST_REQIRED,function(){this.find("name","custName")[0].focus()},this);return}if(!bX.get("custId")){XMG.alert(SYS,M_CUST_MUST_PREDEFINED);return}if(this.find("name","deptId")[0].getValue()==""){XMG.alert(SYS,M_DEPT_REQIRED,function(){this.find("name","deptId")[0].focus()},this);return}if(this.find("name","consSalesRepName")[0].getValue()==""){XMG.alert(SYS,M_SALES_REQIRED,function(){this.find("name","consSalesRepName")[0].focus()},this);return}if(this.find("name","consOperatorId")[0].getValue()==""){XMG.alert(SYS,M_OPERATOR_REQIRED,function(){this.find("name","consOperatorId")[0].focus()},this);return}if(this.find("name","consPolEn")[0].getValue()==""){XMG.alert(SYS,M_POD_REQIRED,function(){this.find("name","consPodEn")[0].focus()},this);return}if(this.find("name","consPodEn")[0].getValue()==""){XMG.alert(SYS,M_POD_REQIRED,function(){this.find("name","consPodEn")[0].focus()},this);return}if(bX.get("consBizClass")==BC_E&&this.find("name","consEtd")[0].getValue()==""){XMG.alert(SYS,M_ETD_REQIRED,function(){this.find("name","consEtd")[0].focus()},this);return}if(bX.get("consBizClass")==BC_I&&this.find("name","consEta")[0].getValue()==""){XMG.alert(SYS,M_ETA_REQIRED,function(){this.find("name","consEta")[0].focus()},this);return}var de=FConsign.prototype.fields;for(var dd=0;dd<de.keys.length;dd++){var b6=""+de.keys[dd];var c8=this.find("name",b6);if(c8!=undefined&&c8.length>0){bX.set(b6,c8[0].getValue())}}var dg=this.findById("cargDanagerFlag");if(dg!=undefined&&dg.checkbox){bX.set("cargDanagerFlag",this.findById("cargDanagerFlag").checkbox.dom.checked)}var c9=this.findById("cargReeterFlag");if(c9!=undefined&&c9.checkbox){bX.set("cargReeterFlag",this.findById("cargReeterFlag").checkbox.dom.checked)}var b2=this.findById("cargBigFlag");if(b2!=undefined&&b2.checkbox){bX.set("cargBigFlag",this.findById("cargBigFlag").checkbox.dom.checked)}if(bX.get("consBizType")==BT_G){bX.set("consServiceRequired",SR_CUDE)}else{if(bX.get("consBizType")==BT_I){bX.set("consServiceRequired",SR_INSP)}else{var db="";if(this.find("name","SR_TRAN")[0]){db+=this.find("name","SR_TRAN")[0].getValue()?SR_TRAN:""}if(this.find("name","SR_WARE")[0]){db+=this.find("name","SR_WARE")[0].getValue()?SR_WARE:""}if(this.find("name","SR_INSP")[0]){db+=this.find("name","SR_INSP")[0].getValue()?SR_INSP:""}if(this.find("name","SR_CUDE")[0]){db+=this.find("name","SR_CUDE")[0].getValue()?SR_CUDE:""}if(this.find("name","SR_CONT")[0]){db+=this.find("name","SR_CONT")[0].getValue()?SR_CONT:""}if(this.find("name","SR_BL")[0]){db+=this.find("name","SR_BL")[0].getValue()?SR_BL:""}if(this.find("name","SR_BBOOK")[0]){db+=this.find("name","SR_BBOOK")[0].getValue()?SR_BBOOK:""}if(this.find("name","SR_RABL")[0]){db+=this.find("name","SR_RABL")[0].getValue()?SR_RABL:""}if(this.find("name","SR_SESH")[0]){db+=this.find("name","SR_SESH")[0].getValue()?SR_SESH:""}bX.set("consServiceRequired",db)}}if(bX.get("consBizType")==BT_C){var dh=this.cont_s.getModifiedRecords();if(dh.length>0){var b7=0;var b5="";var bk=0;var dg=false;c9=false;b2=false;var dc=this.contGrid.getStore().getRange();for(var dd=0;dd<dc.length;dd++){var b4=dc[dd].get("cotyId");var c7=getCOTY(b4);var b8=getCLCODE(b4);var p=getCTEU(b4);var da=dc[dd].get("contNum");bk+=p*da;b5+=da+"X"+c7+" ";b7=b7+da;if(b8=="FR"||b8=="OT"){b2=true}else{if(b8=="DG"){dg=true}else{if(b8=="RF"){c9=true}}}}var m=this.getComponent("T_BOOK_T_"+bX.get("id"));var c6=m.getComponent("C_B_H_"+bX.get("id"));if(b2&&(bX.get("cargLength")==""||bX.get("cargWidth")==""||bX.get("cargHigh")=="")){XMG.alert(SYS,M_BIG_CARGO_INFO,function(){m.setActiveTab(c6)},this);return}if(dg&&(bX.get("cargDanagerClass")==""||bX.get("cargUnNo")=="")){XMG.alert(SYS,M_DANAGER_CARGO_INFO,function(){m.setActiveTab(c6)},this);return}if(c9&&(bX.get("cargTemperature")==""||bX.get("cargTemperatureLow")==""||bX.get("cargTemperatureHigh")=="")){XMG.alert(SYS,M_REEFTER_CARGO_INFO,function(){m.setActiveTab(c6)},this);return}bX.set("consTotalContainers",b7);bX.set("consContainersInfo",b5);bX.set("consContainersTeu",bk)}}var di=this.cargoGrid.getSelectionModel().getSelected();var b3=this.carg_s.getModifiedRecords();bX.set("consCargoPackages",""+bX.get("consTotalPackages")+bX.get("packName"));bX.set("consCargoNetWeight",""+bX.get("consTotalNetWeight")+(bX.get("consBizType")==BT_C?"KGS":"MT"));bX.set("consCargoGrossWeight",""+bX.get("consTotalGrossWeight")+(bX.get("consBizType")==BT_C?"KGS":"MT"));bX.set("consCargoMeasurement",""+bX.get("consTotalMeasurement")+"CBM");var b1=RTX(bX,"FConsign",FConsign);if(bX.get("consBizType")==BT_C){var dh=this.cont_s.getModifiedRecords();if(dh.length>0){var b9=ATX(dh,"FContainer",FContainer);b1=b1+b9}if(bX.get("consBizClass")==BC_I){var c7=this.hbl_s.getModifiedRecords();if(c7.length>0){var b9=ATX(c7,"FBl",FBl);b1=b1+b9}}}if(b3.length>0){var b9=ATX(b3,"FCargo",FCargo);b1=b1+b9}Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:bX.get("wconId")?"WCON_S":"CONS_S"},success:function(dl){var dm=XTR(dl.responseXML,"FConsign",FConsign);var df=bX.get("rowAction");var dk=FConsign.prototype.fields;bX.beginEdit();for(var dj=0;dj<dk.keys.length;dj++){var dp=""+dk.keys[dj];bX.set(dp,dm.get(dp))}if(df=="N"){var ds=T_MAIN.getComponent("C_"+bX.get("id"));var dr=getBT(bX.get("consBizType"))+getBC(bX.get("consBizClass"))+getSHTY(bX.get("consShipType"))+"委托【"+bX.get("consNo")+"】";ds.setTitle(dr);this.find("name","consNo")[0].setValue(bX.get("consNo"));bX.set("rowAction","M")}bX.endEdit();var dq=XTRA(dl.responseXML,"FCargo",FCargo);FOSU(this.carg_s,dq,FCargo);if(bX.get("consBizType")==BT_C){var dn=XTRA(dl.responseXML,"FContainer",FContainer);FOSU(this.cont_s,dn,FContainer)}if(bX.get("consBizType")==BT_C&&bX.get("consBizClass")==BC_I){var dm=XTRA(dl.responseXML,"FBl",FBl);FOSU(this.hbl_s,dm,FBl)}XMG.alert(SYS,M_S);Fos.showConsignTabs(bX)},failure:function(df){XMG.alert(SYS,M_F+df.responseText)},xmlData:FOSX(b1)})};var bx={fieldLabel:bX.get("consBizType")==BT_B?C_CHARTER:C_BOOKER,itemCls:"required",tabIndex:1,name:"custName",value:bX.get("custName"),store:getCS(),enableKeyEvents:true,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("custId","");bX.set("custName","")}},select:function(b4,b3,b1){this.find("name","custContact")[0].setValue(b3.get("custContact"));this.find("name","custTel")[0].setValue(b3.get("custTel"));this.find("name","custFax")[0].setValue(b3.get("custFax"));this.find("name","custSalesId")[0].store.reload({params:{custId:b3.get("custId")}});bX.set("custId",b3.get("custId"));bX.set("custSname",b3.get("custCode"));this.find("name","consShipper")[0].setValue(b3.get("custShipper"));var b2=b3.get("attr9");var m=b3.get("attr10");if(b2!=""||m!=""){var bk="<table width=100% height=100%>";bk+="<tr><td valign=top>";bk+="<br><b>客户特性：</b><br>"+b2;bk+="<br><br><b>操作注意事项：</b><br>"+m;bk+="</td></tr></table>";var p=new Ext.Window({title:bX.get("name"),modal:true,width:400,height:300,autoScroll:true,plain:false,html:bk});p.show()}},keydown:{fn:function(m,p){LC(m,p,"custBookerFlag")},buffer:BF}}};var bv={fieldLabel:C_CONS_NO,style:"{font-weight:bold;color:green;}",disabled:true,tabIndex:5,name:"consNo",value:bX.get("consNo"),xtype:"textfield",anchor:"95%"};var bt={fieldLabel:C_CONTRACT_NO,tabIndex:9,name:"consContractNo",value:bX.get("consContractNo"),xtype:"textfield",anchor:"95%"};var br={fieldLabel:C_CARGO_SOURCE,tabIndex:13,name:"consSource",value:bX.get("consSource"),store:SOUR_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var bp={fieldLabel:C_TTER,itemCls:"needed",tabIndex:17,name:"tranId",value:bX.get("tranId"),store:bX.get("consBizType")==BT_B?getTTB_S():getTTC_S(),xtype:"combo",displayField:"tranCode",valueField:"tranId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("tranId","")}},select:function(bk,p,m){bX.set("tranCode",p.get("tranCode"))}}};var bn={xtype:"checkbox",labelSeparator:"",boxLabel:C_PARTIAL_FLAG,tabIndex:19,name:"consPartialFlag",check:bX.get("consPartialFlag")=="1"};var cj={xtype:"checkbox",labelSeparator:"",boxLabel:C_TANS_FLAG,tabIndex:20,name:"consTransFlag",checked:bX.get("consTransFlag")=="1"};var bj={fieldLabel:C_CONTACT,tabIndex:2,name:"custContact",value:bX.get("custContact"),xtype:"textfield",anchor:"95%"};var bg={fieldLabel:C_CONS_DATE,tabIndex:6,name:"consDate",value:bX.get("consDate"),xtype:"datefield",format:DATEF,anchor:"95%"};var bd={fieldLabel:C_CUST_SALES,tabIndex:10,name:"custSalesId",value:bX.get("custSalesId"),store:getCUCOS(),xtype:"combo",displayField:"cucoName",valueField:"cucoId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var c2={fieldLabel:C_CACL,tabIndex:14,name:"caclId",value:bX.get("caclId"),store:getCACL_S(),xtype:"combo",displayField:"caclNameCn",valueField:"caclId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("caclId","")}},select:function(bk,p,m){bX.set("caclName",p.get("caclNameCn"))}}};var c1={fieldLabel:C_SHLI,itemCls:"needed",tabIndex:18,name:"shliId",value:bX.get("shliId"),store:getSHLI_S(),xtype:"combo",displayField:"shliName",valueField:"shliId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("shliId","")}},select:function(bk,p,m){bX.set("shliCode",p.get("shliCode"))}}};var c0={fieldLabel:C_LCL_TYPE,tabIndex:22,name:"consLclType",value:bX.get("consLclType"),disabled:bX.get("consShipType")!="LCL",store:LCLT_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var cZ={fieldLabel:C_PHONE,tabIndex:3,name:"custTel",value:bX.get("custTel"),xtype:"textfield",anchor:"95%"};var cY={fieldLabel:C_DEPT,itemCls:"required",tabIndex:7,name:"deptId",value:bX.get("deptId"),store:getGROU_S(),xtype:"combo",displayField:"grouName",valueField:"grouId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var cX={fieldLabel:C_REF_NO,tabIndex:11,name:"consRefNo",value:bX.get("consRefNo"),xtype:"textfield",anchor:"95%"};var cW={fieldLabel:C_PATE,itemCls:"needed",tabIndex:15,name:"pateId",value:bX.get("pateId"),store:getPATE_S(),xtype:"combo",displayField:"pateName",valueField:"pateId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("pateId","")}},select:function(bk,p,m){bX.set("pateName",p.get("pateName"))}}};var cV={fieldLabel:C_CHARGE_REMARKS,tabIndex:16,name:"consChargeRemarks",value:bX.get("consChargeRemarks"),xtype:"textfield",anchor:"95%"};var cU={fieldLabel:C_M_CONS_NO,disabled:true,tabIndex:23,name:"consMasterNo",value:bX.get("consMasterNo"),xtype:"textfield",anchor:"95%"};var cT={xtype:"textfield",tabIndex:4,fieldLabel:C_FAX,name:"custFax",value:bX.get("custFax"),anchor:"95%"};var cE={fieldLabel:C_SALES,itemCls:"required",tabIndex:8,name:"consSalesRepName",value:bX.get("consSalesRepName"),store:getSALE_S(),xtype:"combo",displayField:VERSION==1?"userName":"userLoginName",valueField:"userName",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consSalesRepId","");bX.set("consSalesRepName","")}},select:function(bk,p,m){bX.set("consSalesRepId",p.get("userId"))}}};var cD={fieldLabel:C_OPERATOR,itemCls:"required",tabIndex:12,name:"consOperatorId",value:bX.get("consOperatorId"),store:getOP_S(),xtype:"combo",displayField:VERSION==1?"userName":"userLoginName",valueField:"userId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consOperatorId","");bX.set("consOperatorName","")}},select:function(bk,p,m){bX.set("consOperatorName",p.get("userName"))}}};var cC={fieldLabel:C_PAID_AT,tabIndex:16,name:"consPaidAt",value:bX.get("consPaidAt"),xtype:"textfield",anchor:"95%"};var cB={fieldLabel:C_BVESSEL,tabIndex:18,name:"consBVessel",value:bX.get("consBVessel"),xtype:"textfield",anchor:"95%"};var cA={fieldLabel:C_BVOYAGE,tabIndex:19,name:"consBVoyage",value:bX.get("consBVoyage"),xtype:"textfield",anchor:"95%"};var cz={fieldLabel:C_BPOT,tabIndex:20,name:"consBPodEn",value:bX.get("consBPodEn"),xtype:"textfield",anchor:"95%"};var cy={fieldLabel:C_DELIVERY_DATE,tabIndex:14,name:"consDeliveryDate",value:bX.get("consDeliveryDate"),xtype:"datefield",format:DATEF,anchor:"95%"};var v=[];var u=[];var t=[];var s=[];if(bX.get("consBizClass")==BC_I){v=[bx,bv,bt,br,bp];u=[bj,bg,bd,cy,cB];t=[cZ,cY,cX,cW,cA];s=[cT,cE,cD,cC,cz];if(bX.get("consBizType")==BT_A){u=[bj,bg,bd,cy];t=[cZ,cY,cX,cW];s=[cT,cE,cD,cC]}}else{v=[bx,bv,bt,br,bp];u=[bj,bg,bd,c2,c1];t=[cZ,cY,cX,cW,bn];s=[cT,cE,cD,cC,cj];if(bX.get("consShipType")==ST_L){u=[bj,bg,bd,c2,c1,c0];t=[cZ,cY,cX,cW,cV,cU]}else{if(bX.get("consBizType")==BT_A){u=[bj,bg,bd,cy];t=[cZ,cY,cX,cW];s=[cT,cE,cD,cC]}}}var cp={layout:"column",title:C_CONS_INFO,collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:v},{columnWidth:0.25,layout:"form",labelWidth:70,border:false,items:u},{columnWidth:0.25,layout:"form",labelWidth:70,border:false,items:t},{columnWidth:0.25,layout:"form",labelWidth:70,border:false,items:s}]};var r=function(p,b1,bk,m){return{columnWidth:0.1,layout:"form",border:false,labelWidth:0,labelSeparator:"",hideLabels:true,items:[{boxLabel:p,tabIndex:m,name:b1,checked:bX.get("consServiceRequired").indexOf(bk)!=-1,xtype:"checkbox",anchor:"100%"}]}};var a2={columnWidth:0.1,layout:"form",border:false,items:[{text:C_SERVICE_REQUIRED,style:"{font-size:12px;}",xtype:"label",anchor:"100%"}]};var a1=r(C_SR_TRAN,"SR_TRAN",SR_TRAN,25);var a0=r(C_SR_WARE,"SR_WARE",SR_WARE,26);var aZ=r(C_SR_CONT,"SR_CONT",SR_CONT,27);var aY=r(C_SR_BL,"SR_BL",SR_BL,28);var aX=r(C_SR_INSP,"SR_INSP",SR_INSP,29);var aW=r(C_SR_CUDE,"SR_CUDE",SR_CUDE,30);var aV=r(C_SR_BBOOK,"SR_BBOOK",SR_BBOOK,31);var aU=r(C_SR_SESH,"SR_SESH",SR_SESH,32);var R=r(C_SR_RABL,"SR_RABL",SR_RABL,33);var ah=[a2,a1,a0,aX,aW];if(bX.get("consBizType")==BT_B&&bX.get("consBizClass")==BC_E){ah=[a2,a1,a0,aY,aX,aW,aV,aU,R]}else{if(bX.get("consBizType")==BT_A){ah=[a2,a1,a0,aY,aX,aW]}else{if(bX.get("consBizType")==BT_C&&bX.get("consBizClass")==BC_E){ah=[a2,a1,a0,aZ,aY,aX,aW,aV,aU,R]}}}var cn={layout:"column",frame:true,height:35,items:ah};var w="";if(bX.get("consBizType")==BT_C){w=1}else{if(bX.get("consBizType")==BT_B){w=2}}var o={fieldLabel:C_VESS,itemCls:"needed",tabIndex:34,name:"vessName",value:bX.get("vessName"),store:getVES(),enableKeyEvents:true,xtype:"combo",displayField:"vessNameEn",valueField:"vessNameEn",typeAhead:true,mode:"local",tpl:vessTpl,itemSelector:"div.list-item",listWidth:400,triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,select:function(b1,bk,p){bX.set("vessId",bk.get("vessId"));bX.set("vessNameCn",bk.get("vessNameCn"));var m=this.find("name","vessNameCn")[0];if(m){m.setValue(bk.get("vessNameCn"))}},blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("vessId","");bX.set("vessName","")}},keydown:{fn:function(m,p){LV(m,p,w)},buffer:BF}}};var n={fieldLabel:bX.get("consBizType")==BT_A?C_FLIGHTER:C_CARRIER,itemClass:"needed",tabIndex:bX.get("consBizClass")==BC_I?42:38,name:"consCarrierName",value:bX.get("consCarrierName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consCarrier","");bX.set("consCarrierName","")}},select:function(bk,p,m){bX.set("consCarrier",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custCarrierFlag")},buffer:BF}}};var l={fieldLabel:C_OVERSEA_AGENCY,tabIndex:bX.get("consBizClass")==BC_I?46:42,name:"consOverseaAgencyName",value:bX.get("consOverseaAgencyName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consOverseaAgency","");bX.set("consOverseaAgencyName","")}},select:function(bk,p,m){bX.set("consOverseaAgency",p.get("custId"));this.find("name","consNotifyParty2")[0].setValue(p.get("custAddress2"))},keydown:{fn:function(m,p){LC(m,p,"custOverseaAgencyFlag")},buffer:BF}}};var k={fieldLabel:bX.get("consBizClass")==BC_E?C_COUNTRY_D:C_COUNTRY_L,tabIndex:46,disabled:true,name:"consTradeCountry",value:bX.get("consTradeCountry"),store:getCOUN_S(),xtype:"combo",displayField:"counNameEn",valueField:"counCode",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var j={fieldLabel:C_BL_REMARKS,tabIndex:50,name:"consBlRemarks",value:bX.get("consBlRemarks"),xtype:"textfield",anchor:"95%"};var i={fieldLabel:"S/O No.",name:"consSoNo",tabIndex:54,value:bX.get("consSoNo"),xtype:"textfield",anchor:"95%"};var h={fieldLabel:C_CONTAINER,tabIndex:bX.get("consBizClass")==BC_I?48:58,name:"consContainerCompanyName",value:bX.get("consContainerCompanyName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consContainerCompany","");bX.set("consContainerCompanyName","")}},select:function(bk,p,m){bX.set("consContainerCompany",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custContainerFlag")},buffer:BF}}};var g={fieldLabel:bX.get("consBizType")==BT_A?C_FLIGHT:C_VOYA,itemCls:"needed",tabIndex:35,name:"voyaName",value:bX.get("voyaName"),xtype:"textfield",anchor:"95%"};var f={fieldLabel:C_BOOK_AGENCY,tabIndex:39,name:"consBookingAgencyName",value:bX.get("consBookingAgencyName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consBookingAgency","");bX.set("consBookingAgencyName","")}},select:function(bk,p,m){bX.set("consBookingAgency",p.get("custId"));bX.set("consBookingAgencySname",p.get("custCode"))},keydown:{fn:function(m,p){LC(m,p,"custBookingAgencyFlag")},buffer:BF}}};var am={fieldLabel:C_POL,itemCls:"required",tabIndex:bX.get("consBizClass")==BC_I?39:43,name:"consPolEn",value:bX.get("consPolEn"),store:getPS(),xtype:"combo",displayField:"portNameEn",valueField:"portNameEn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",tpl:portTpl,itemSelector:"div.list-item",listWidth:C_LW,enableKeyEvents:true,listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consPol","")}},select:function(bk,p,m){bX.set("consPol",p.get("portId"));if(bX.get("consBizClass")==BC_I&&this.find("name","consTradeCountry")[0]){this.find("name","consTradeCountry")[0].setValue(p.get("counCode"))}if(bX.get("consBizClass")==BC_E&&this.find("name","consReceiptPlace")[0]){this.find("name","consReceiptPlace")[0].setValue(p.get("portNameEn"))}},keydown:{fn:LP,buffer:BF}}};var al={fieldLabel:C_POD,itemCls:"required",tabIndex:bX.get("consBizClass")==BC_I?40:47,name:"consPodEn",value:bX.get("consPodEn"),store:getPS(),xtype:"combo",displayField:"portNameEn",valueField:"portNameEn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",tpl:portTpl,itemSelector:"div.list-item",listWidth:C_LW,enableKeyEvents:true,listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consPod","")}},select:function(bk,p,m){bX.set("consPod",p.get("portId"));if(this.find("name","consTradeCountry")[0]){this.find("name","consTradeCountry")[0].setValue(p.get("counCode"))}if(this.find("name","consDeliveryPlace")[0]){this.find("name","consDeliveryPlace")[0].setValue(p.get("portNameEn"))}if(this.find("name","consDestination")[0]){this.find("name","consDestination")[0].setValue(p.get("portNameEn"))}},keydown:{fn:LP,buffer:BF}}};var ak={fieldLabel:C_POT,tabIndex:bX.get("consBizClass")==BC_I?41:51,name:"consPotEn",value:bX.get("consPotEn"),xtype:"textfield",anchor:"95%"};var aj={fieldLabel:C_BOOKING_CONTRACT_NO,name:"consBookingContractNo",tabIndex:55,value:bX.get("consBookingContractNo"),xtype:"textfield",anchor:"95%"};var ai={fieldLabel:C_PACKING_LIST_NO,tabIndex:59,name:"consPackingListNo",value:bX.get("consPackingListNo"),xtype:"textfield",anchor:"95%"};var ag={fieldLabel:bX.get("consBizType")==BT_A?"MAWB No.":C_MBL_NO,tabIndex:36,name:"consMblNo",value:bX.get("consMblNo"),xtype:"textfield",anchor:"95%"};var af={fieldLabel:C_SHIP_LOAD_DATE,tabIndex:40,name:"consLoadDate",value:bX.get("consLoadDate"),xtype:"datefield",format:DATEF,anchor:"95%"};var ae={fieldLabel:C_HARBOUR,tabIndex:bX.get("consBizClass")==BC_I?43:44,name:"consHarbour",value:bX.get("consHarbour"),store:getHARB_S(),xtype:"combo",displayField:"placName",valueField:"placName",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,select:function(bk,p,m){bX.set("consHarbourId",p.get("placId"))}}};var ad={fieldLabel:C_DELIVERY_PLACE,tabIndex:48,name:"consDeliveryPlace",value:bX.get("consDeliveryPlace"),xtype:"textfield",anchor:"95%"};var ac={fieldLabel:C_ISTY,tabIndex:52,name:"istyId",value:bX.get("istyId"),store:getISTY_S(),xtype:"combo",displayField:"istyName",valueField:"istyId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var Q={fieldLabel:C_BOOKING_DATE,tabIndex:56,name:"consBookingDate",value:bX.get("consBookingDate"),xtype:"datefield",format:DATEF,anchor:"95%"};var P={fieldLabel:C_CFS,tabIndex:bX.get("consBizClass")==BC_I?49:60,name:"consCfsName",value:bX.get("consCfsName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consCfs","");bX.set("consCfsName","")}},select:function(bk,p,m){bX.set("consCfs",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custCfsFlag")},buffer:BF}}};var O={fieldLabel:C_CUSTOM_EXPIRY_DATE,tabIndex:41,name:"consExpiryDate",value:bX.get("consExpiryDate"),xtype:"datefield",format:DATEF,anchor:"95%"};var N={fieldLabel:C_RECEIPT_PLACE,tabIndex:45,name:"consReceiptPlace",value:bX.get("consReceiptPlace"),xtype:"textfield",anchor:"95%"};var M={fieldLabel:C_DESTINATION,tabIndex:49,name:"consDestination",value:bX.get("consDestination"),xtype:"textfield",anchor:"95%"};var L={fieldLabel:C_PRECARRIAGE,tabIndex:53,name:"consPrecarriage",value:bX.get("consPrecarriage"),xtype:"textfield",anchor:"95%"};var K={fieldLabel:C_BL_ORI_NUM,name:"consOriginalBlNum",tabIndex:64,value:bX.get("consOriginalBlNum"),xtype:"numberfield",anchor:"95%"};var J={fieldLabel:C_DO_AGENCY,name:"consDoAgencyName",tabIndex:47,value:bX.get("consDoAgencyName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consDoAgency","");bX.set("consDoAgencyName","")}},select:function(bk,p,m){bX.set("consDoAgency",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custDoAgencyFlag")},buffer:BF}}};var I={fieldLabel:bX.get("consBizType")==BT_A?"HAWB No.":C_HBL_NO,name:"consHblNo",tabIndex:37,value:bX.get("consHblNo"),xtype:"textfield",anchor:"95%"};var F={fieldLabel:C_ETA,name:"consEta",itemCls:bX.get("consBizClass")==BC_I?"required":"",tabIndex:44,value:bX.get("consEta"),xtype:"datefield",format:DATEF,anchor:"95%",listeners:{scope:this,change:function(bk,m,p){if(bX.get("consBizClass")==BC_I){bX.set("consSailDate",m)}}}};var E={fieldLabel:bX.get("consBizClass")==BC_E?C_SAIL_DATE:C_ETD,itemCls:bX.get("consBizClass")==BC_E?"required":"",tabIndex:37,name:"consEtd",value:bX.get("consEtd"),xtype:"datefield",format:DATEF,anchor:"95%",listeners:{scope:this,change:function(bk,m,p){if(bX.get("consBizClass")==BC_E){bX.set("consSailDate",m)}}}};var D={fieldLabel:C_VESS_NAME_CN,name:"vessNameCn",tabIndex:54,value:bX.get("vessNameCn"),xtype:"textfield",anchor:"95%"};var C={fieldLabel:C_TTER,itemCls:"required",tabIndex:58,name:"tranIdCarrier",value:bX.get("tranIdCarrier"),store:bX.get("consBizType")==BT_B?getTTB_S():getTTC_S(),xtype:"combo",displayField:"tranCode",valueField:"tranId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("tranIdCarrier","")}},select:function(bk,p,m){bX.set("tranCodeCarrier",p.get("tranCodeCarrier"))}}};var B={fieldLabel:C_PATE,itemCls:"required",tabIndex:59,name:"pateIdP",value:bX.get("pateIdP"),store:getPATE_S(),xtype:"combo",displayField:"pateName",valueField:"pateId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("pateIdP","")}},select:function(bk,p,m){bX.set("pateNameP",p.get("pateNameP"))}}};var A={fieldLabel:C_BL_PACKAGES,name:"blCargoPackages",value:bX.get("blCargoPackages"),disabled:true,xtype:"numberfield",anchor:"95%"};var z={fieldLabel:C_BL_GW,name:"blCargoGrossWeight",value:bX.get("blCargoGrossWeight"),disabled:true,xtype:"numberfield",allowDecimals:true,decimalPrecision:4,anchor:"95%"};var y={fieldLabel:C_BL_NW,name:"blCargoNetWeight",value:bX.get("blCargoNetWeight"),disabled:true,xtype:"numberfield",allowDecimals:true,decimalPrecision:4,anchor:"95%"};var x={fieldLabel:C_BL_CBM,name:"blCargoMeasurement",value:bX.get("blCargoMeasurement"),disabled:true,xtype:"numberfield",allowDecimals:true,decimalPrecision:4,anchor:"95%"};var cQ=[];var cO=[];var cL=[];var cJ=[];if(bX.get("consBizClass")==BC_I){cQ=[o,k,n,l];cO=[g,am,ae,J];cL=[ag,al,F,h];cJ=[I,ak,E,P];if(bX.get("consBizType")==BT_A){cQ=[n,k,al];cO=[g,am,ae];cL=[ag,F,ak];cJ=[I,E,l]}else{if(bX.get("consBizType")==BT_B){cQ=[o,k,n,l];cO=[g,am,ae];cL=[ag,al,F,h];cJ=[I,ak,E]}}}else{cQ=[o,n,l,k,j,i,h];cO=[g,f,am,al,ak,aj,ai];cL=[ag,af,ae,ad,ac,Q,P];cJ=[E,F,N,M,L,O,K];if(bX.get("consBizType")==BT_A){cQ=[n,k,am];cO=[g,al,ae];cL=[ag,F,ak];cJ=[I,E,l]}else{if(bX.get("consBizType")==BT_B){cQ=[o,n,l,k,j,D,C,A];cO=[g,f,am,al,ak,aj,B,z];cL=[ag,af,ae,ad,ac,Q,K,y];cJ=[E,F,N,M,L,O,x]}}}var cl={layout:"column",title:C_BL_INFO,collapsible:true,items:[{columnWidth:0.25,layout:"form",labelWidth:80,border:false,items:cQ},{columnWidth:0.25,layout:"form",labelWidth:80,border:false,items:cO},{columnWidth:0.25,layout:"form",labelWidth:80,border:false,items:cL},{columnWidth:0.25,layout:"form",labelWidth:80,border:false,items:cJ}]};var ck={layout:"column",title:C_SHIPPER_INFO,collapsible:true,items:[{columnWidth:0.5,layout:"form",border:false,labelWidth:60,items:[{fieldLabel:C_SHIPPER,tabIndex:65,name:"consShipper",value:bX.get("consShipper"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,labelWidth:60,items:[{fieldLabel:C_CONSIGNEE,tabIndex:66,name:"consConsignee",value:bX.get("consConsignee"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,labelWidth:60,items:[{fieldLabel:C_NOTIFIER,tabIndex:67,name:"consNotifyParty",value:bX.get("consNotifyParty"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,labelWidth:60,items:[{fieldLabel:C_OVERSEA_AGENCY,tabIndex:68,name:"consNotifyParty2",value:bX.get("consNotifyParty2"),xtype:"textarea",height:100,anchor:"95%"}]}]};var aD={id:"C_B_J_"+bX.get("id"),title:C_BASE_INFO+"(J)",height:650,items:(bX.get("consBizType")==BT_G||bX.get("consBizType")==BT_I)?[cp,cl,ck]:[cp,cn,cl,ck]};if(bX.get("consBizType")==BT_C){var aC={id:"C_B_X_"+bX.get("id"),title:C_CONT_INFO+"(X)",layout:"fit",height:400,items:[this.contGrid]}}var aT={columnWidth:0.5,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_MARKS,tabIndex:58,name:"consCargoMarks",value:bX.get("consCargoMarks"),xtype:"textarea",height:100,anchor:"95%"}]};var aS={columnWidth:0.5,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_CARGO_DESC,tabIndex:61,name:"consCargoDesc",value:bX.get("consCargoDesc"),xtype:"textarea",height:100,anchor:"95%"}]};var aR={columnWidth:0.3,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_NUM_PACK,tabIndex:61,name:"consTotalPackages",value:bX.get("consTotalPackages"),xtype:"numberfield",anchor:"95%",listeners:{scope:this,change:function(b1,m,p){bX.set("consTotalPackages",m);var bk="SAY TOTAL "+N2EW(bX.get("consTotalPackages"))+" "+bX.get("packName")+" ONLY";this.find("name","consTotalPackagesInWord")[0].setValue(bk);bX.set("consTotalPackagesInWord",bk)}}}]};var aQ={columnWidth:0.2,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:"",hideLabel:true,labelSeparator:"",tabIndex:61,name:"packId",value:bX.get("packId"),xtype:"combo",store:getPACK_S(),displayField:"packName",valueField:"packId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,select:function(b1,bk,m){bX.set("packName",bk.get("packName"));var p="SAY TOTAL "+N2EW(bX.get("consTotalPackages"))+" "+bX.get("packName")+" ONLY";this.find("name","consTotalPackagesInWord")[0].setValue(p);bX.set("consTotalPackagesInWord",p)}}}]};var aP={columnWidth:0.16,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_GW+(bX.get("consBizType")==BT_B?C_MT:C_KGS),tabIndex:61,name:"consTotalGrossWeight",value:bX.get("consTotalGrossWeight"),xtype:"numberfield",decimalPrecision:4,anchor:"95%"}]};var aN={columnWidth:0.16,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_NW+(bX.get("consBizType")==BT_B?C_MT:C_KGS),tabIndex:61,name:"consTotalNetWeight",value:bX.get("consTotalNetWeight"),xtype:"numberfield",decimalPrecision:4,anchor:"95%"}]};var aL={columnWidth:0.18,layout:"form",labelWidth:70,border:false,items:[{fieldLabel:C_CBM,tabIndex:61,name:"consTotalMeasurement",value:bX.get("consTotalMeasurement"),xtype:"numberfield",decimalPrecision:4,anchor:"95%"}]};var aH={columnWidth:0.5,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_PACKAGES_CAP,tabIndex:61,name:"consTotalPackagesInWord",value:bX.get("consTotalPackagesInWord"),xtype:"textfield",anchor:"95%"}]};var aF={columnWidth:0.25,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_CARGO_NAME_CN,tabIndex:61,name:"consCargoNameCn",value:bX.get("consCargoNameCn"),xtype:"textfield",anchor:"95%"}]};var ax={columnWidth:0.25,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_CARGO_NAME_EN,tabIndex:61,name:"consCargoNameEn",value:bX.get("consCargoNameEn"),xtype:"textfield",anchor:"95%"}]};var H={columnWidth:0.5,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_CARGO_DIMENSION,tabIndex:61,name:"consCargoDimension",value:bX.get("consCargoDimension"),xtype:"textarea",height:100,anchor:"95%"}]};var G={columnWidth:0.25,layout:"form",labelWidth:60,border:false,items:[{fieldLabel:C_CHARGE_WEIGHT,tabIndex:58,name:"consTotalChargeWeight",value:bX.get("consTotalChargeWeight"),xtype:"numberfield",anchor:"95%"}]};var bN={layout:"column",layoutConfig:{columns:5},deferredRender:false,border:false,labelWidth:60,title:"货物小计",collapsible:true,items:bX.get("consBizType")==BT_A?[aT,aS,H,aR,aQ,aH,aP,aN,aL,G,ax]:[aT,aS,aR,aQ,aP,aN,aL,aH,aF,ax]};var aw={fieldLabel:C_DANAGER_CLASS,name:"cargDanagerClass",value:bX.get("cargDanagerClass"),anchor:"90%"};var av={fieldLabel:C_IMDG_PAGE,name:"cargImdgPage",value:bX.get("cargImdgPage"),anchor:"90%"};var au={fieldLabel:C_UN_NO,name:"cargUnNo",value:bX.get("cargUnNo"),anchor:"90%"};var at={fieldLabel:C_SUB_LABEL,name:"cargSubLabel",value:bX.get("cargSubLabel"),anchor:"90%"};var ar={fieldLabel:C_EMS_NO,name:"cargEmsNo",value:bX.get("cargEmsNo"),anchor:"90%"};var aq={fieldLabel:C_FLASH_POINT,name:"cargFlashPoint",value:bX.get("cargFlashPoint"),anchor:"90%"};var ap={fieldLabel:C_MFAG_NO,name:"cargMfagNo",value:bX.get("cargMfagNo"),anchor:"90%"};var ao={fieldLabel:C_PKG_GROUP,name:"cargPkgGroup",value:bX.get("cargPkgGroup"),anchor:"90%"};var an={fieldLabel:C_DANAGER_PROPERTY,name:"cargDanagerProperty",value:bX.get("cargDanagerProperty"),anchor:"90%"};var ab={fieldLabel:C_POLLUTION_FLAG,name:"cargPollutionFlag",value:bX.get("cargPollutionFlag"),xtype:"checkbox",anchor:"90%"};var aa={fieldLabel:C_TEMPERATURE_UNIT,name:"cargTemperatureUnit",value:bX.get("cargTemperatureUnit"),editable:false,store:TEUN_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"90%"};var Z={fieldLabel:C_TEMPERATURE,name:"cargTemperature",value:bX.get("cargTemperature"),xtype:"numberfield",anchor:"90%"};var Y={fieldLabel:C_TEMPERATURE_HIGH,name:"cargTemperatureHigh",value:bX.get("cargTemperatureHigh"),xtype:"numberfield",anchor:"90%"};var X={fieldLabel:C_TEMPERATURE_LOW,name:"cargTemperatureLow",value:bX.get("cargTemperatureLow"),xtype:"numberfield",anchor:"90%"};var W={fieldLabel:C_VENT_OUTLET,name:"cargVentOutlet",value:bX.get("cargVentOutlet"),xtype:"textfield",anchor:"90%"};var V={fieldLabel:C_HUMIDITY,name:"cargHumidity",value:bX.get("cargHumidity"),xtype:"numberfield",anchor:"90%"};var U={fieldLabel:C_LENGTH,name:"cargLength",value:bX.get("cargLength"),xtype:"numberfield",anchor:"90%"};var T={fieldLabel:C_WIDTH,name:"cargWidth",value:bX.get("cargWidth"),xtype:"numberfield",anchor:"90%"};var S={fieldLabel:C_HEIGH,name:"cargHigh",value:bX.get("cargHigh"),xtype:"numberfield",anchor:"90%"};var bL={layout:"column",layoutConfig:{columns:3},title:C_CARGO_SPECIAL_INFO,border:false,collapsible:true,items:[{columnWidth:0.33,border:false,items:[{id:"cargDanagerFlag",xtype:"fieldset",labelAlign:"right",labelWidth:80,checkboxToggle:true,checkboxName:"cargDanagerFlag",title:"危险品",autoHeight:true,defaultType:"textfield",collapsed:bX.get("cargDanagerFlag")==0,items:[aw,av,au,at,ar,aq,ap,ao,an,ab]}]},{columnWidth:0.34,border:false,items:[{id:"cargReeterFlag",xtype:"fieldset",labelAlign:"right",labelWidth:80,checkboxToggle:true,checkboxName:"cargReeterFlag",title:"冷藏品",autoHeight:true,autoWidth:true,collapsed:bX.get("cargReeterFlag")==0,items:[aa,Z,Y,X,W,V]}]},{columnWidth:0.33,border:false,items:[{id:"cargBigFlag",xtype:"fieldset",labelAlign:"right",labelWidth:70,checkboxToggle:true,checkboxName:"cargBigFlag",title:"大件货",autoHeight:true,collapsed:bX.get("cargBigFlag")==0,items:[U,T,S]}]}]};var aB={id:"C_B_H_"+bX.get("id"),title:C_CARGO_INFO+"(H)",height:600,autoScroll:true,items:[{layout:"fit",border:false,collapsible:true,items:this.cargoGrid},bN,bL]};var bJ={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_SERVICE_SPEC,tabIndex:1,name:"consServiceSpec",value:bX.get("consServiceSpec"),xtype:"textarea",anchor:"95%"}]};var bI={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_REMARKS,tabIndex:2,name:"consRemarks",value:bX.get("consRemarks"),xtype:"textarea",anchor:"95%"}]};var bm={title:C_BOOKING_REQUIREMENT,layout:"column",labelWidth:70,collapsible:true,items:[bJ,bI]};var bH={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_TRACK_VENDOR,tabIndex:3,name:"consTrackVendorName",value:bX.get("consTrackVendorName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consTrackVendor","");bX.set("consTrackVendorName","")}},select:function(bk,p,m){bX.set("consTrackVendor",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custTrackFlag")},buffer:BF}}}]};var bG={columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_TRACK_CONTACT,tabIndex:4,name:"consTrackContact",value:bX.get("consTrackContact"),xtype:"textfield",anchor:"95%"}]};var bF={columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_TRACK_TEL,tabIndex:5,name:"consTrackTel",value:bX.get("consTrackTel"),xtype:"textfield",anchor:"95%"}]};var bE={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:bX.get("consBizClass")==BC_E?C_LOAD_ADDRESS:C_DELIVERY_ADDRESS,tabIndex:6,name:"consTrackLoadAddress",value:bX.get("consTrackLoadAddress"),xtype:"textarea",anchor:"95%"}]};var bD={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_REMARKS,tabIndex:7,name:"consTrackRemarks",value:bX.get("consTrackRemarks"),xtype:"textarea",anchor:"95%"}]};var bC={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:bX.get("consBizClass")==BC_E?C_LOAD_DATE:C_FETCH_DATE,tabIndex:8,name:"consTrackLoadDate",value:bX.get("consTrackLoadDate"),xtype:"datefield",format:DATEF,anchor:"50%"}]};var bi={title:C_TRAN_REQUIREMENT,layout:"column",labelWidth:70,collapsible:true,items:[bH,bG,bF,bE,bD,bC]};var bB={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_WAREHOUSE,tabIndex:9,name:"consWarehouseName",value:bX.get("consWarehouseName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consWarehouse","");bX.set("consWarehouseName","")}},select:function(bk,p,m){this.find("name","consWarehouseContact")[0].setValue(p.get("custContact"));this.find("name","consWarehouseTel")[0].setValue(p.get("custTel"));bX.set("consWarehouse",p.get("custId"));bX.set("consWarehouseFax",p.get("custFax"))},keydown:{fn:function(m,p){LC(m,p,"custWarehouseFlag")},buffer:BF}}}]};var cx={columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_CONTACT,tabIndex:10,name:"consWarehouseContact",value:bX.get("consWarehouseContact"),xtype:"textfield",anchor:"95%"}]};var cw={columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_TEL,tabIndex:11,name:"consWarehouseTel",value:bX.get("consWarehouseTel"),xtype:"textfield",anchor:"95%"}]};var cv={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:bX.get("consBizType")==BT_B?C_WARE_REQUIREMENT:(bX.get("consBizClass")==BC_E?C_CONT_LOAD_REQUIREMENT:C_CONT_DISCHARGE_REQUIREMENT),tabIndex:12,name:"consWarehouseRemarks",value:bX.get("consWarehouseRemarks"),xtype:"textarea",anchor:"95%"}]};var cu={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:bX.get("consBizType")==BT_B?C_WARE_ADDRESS:(bX.get("consBizClass")==BC_E?C_CONT_LOAD_ADDRESS:C_CONT_DISCHARGE_ADDRESS),tabIndex:13,name:"consWarehouseAddress",value:bX.get("consWarehouseAddress"),xtype:"textarea",anchor:"95%"}]};var ct={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:bX.get("consBizType")==BT_B?C_WARE_DATE:(bX.get("consBizClass")==BC_E?C_WARE_LOAD_DATE:C_WARE_DIS_DATE),tabIndex:14,name:"consContainerLoadDate",value:bX.get("consContainerLoadDate"),xtype:"datefield",format:DATEF,anchor:"50%"}]};var cs={columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_CFS,tabIndex:14,name:"consCfsName",value:bX.get("consCfsName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:400,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consCfs","");bX.set("consCfsName","")}},select:function(bk,p,m){bX.set("consCfs",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custCfsFlag")},buffer:BF}}}]};var bf={title:bX.get("consBizType")==BT_B?C_SR_WARE:(bX.get("consBizClass")==BC_E?C_WARE_LOAD:C_WARE_DIS),layout:"column",collapsible:true,labelWidth:70,items:bX.get("consBizType")==BT_B?[bB,cx,cw,cv,cu,ct]:[bB,cx,cw,cv,cu,ct,cs]};var cs={fieldLabel:C_INSP_AGENCY,tabIndex:15,name:"consInspectionVendorName",value:bX.get("consInspectionVendorName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consInspectionVendor","");bX.set("consInspectionVendorName","")}},select:function(bk,p,m){bX.set("consInspectionVendor",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custInspectionFlag")},buffer:BF}}};var cr={fieldLabel:C_CUSTOM_AGENCY,tabIndex:16,name:"consCustomsVendorName",value:bX.get("consCustomsVendorName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:400,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consCustomsVendor","");bX.set("consCustomsVendorName","")}},select:function(bk,p,m){bX.set("consCustomsVendor",p.get("custId"))},keydown:{fn:function(m,p){LC(m,p,"custCustomFlag")},buffer:BF}}};var cq={fieldLabel:C_SWITCH_BL,tabIndex:17,name:"swithId",value:bX.get("swithId"),store:SWIT_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var co={fieldLabel:C_FUMIGATE_FLAG,tabIndex:18,name:"consFumigateFlag",checked:bX.get("consFumigateFlag")=="1",xtype:"checkbox",anchor:"95%"};var cm={fieldLabel:C_QUARANTINE_FLAG,tabIndex:19,name:"consQuarantineFlag",checked:bX.get("consQuarantineFlag")=="1",xtype:"checkbox",anchor:"95%"};var ch={fieldLabel:C_TRANSFERRING_FLAG,tabIndex:20,name:"consTransferringFlag",checked:bX.get("consTransferringFlag")=="1",xtype:"checkbox",anchor:"95%"};var cg={fieldLabel:C_CUDE_TYPE,tabIndex:21,name:"consCudeType",value:bX.get("consCudeType"),store:CUTY_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var cf={fieldLabel:C_INV_FLAG,xtype:"checkbox",tabIndex:22,name:"consInvoiceFlag",checked:bX.get("consInvoiceFlag")=="1",anchor:"95%"};var ce={fieldLabel:C_INSP_FLAG,xtype:"checkbox",tabIndex:23,name:"consInspectionFlag",checked:bX.get("consInspectionFlag")=="1",anchor:"95%"};var bc={title:C_CUST_REQUIREMENT,layout:"column",collapsible:true,items:[{columnWidth:0.5,layout:"form",border:false,labelWidth:70,items:[cs]},{columnWidth:0.5,layout:"form",border:false,labelWidth:70,items:[cr]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[cq,cg]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[co,cf]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[cm,ce]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[ch]}]};var cd={fieldLabel:C_BHK_FLAG,tabIndex:24,name:"consBHkFlag",checked:bX.get("consBHkFlag")=="1",xtype:"checkbox",anchor:"95%"};var cc={fieldLabel:C_BINTERNATIONAL_FLAG,tabIndex:25,name:"consBInternationalFlag",checked:bX.get("consBInternationalFlag")=="1",xtype:"checkbox",anchor:"95%"};var cb={fieldLabel:C_REMARKS,tabIndex:26,name:"consBRemarks",value:bX.get("consWarehouseRemarks"),xtype:"textarea",anchor:"95%"};var ba={title:C_BARGE_REQUIREMENT,layout:"column",deferredRender:false,collapsible:true,items:[{columnWidth:0.4,layout:"form",border:false,items:[cd,cc]},{columnWidth:0.6,layout:"form",border:false,items:[cb]}]};var aA={id:"C_B_Y_"+bX.get("id"),title:C_SERVICE_REQUIREMENT+"(Y)",height:600,autoScroll:true,items:bX.get("consBizClass")==BC_E?[bm,bi,bf,bc,ba]:[bm,bi,bf,bc]};var ca={fieldLabel:C_CARGO_OWNER,tabIndex:1,name:"consCargoOwnerName",value:bX.get("consCargoOwnerName"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listWidth:200,pageSize:30,listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();bX.set("consCargoOwner","");bX.set("consCargoOwnerName","")}},select:function(bk,p,m){bX.set("consCargoOwner",p.get("custId"))},keydown:function(m,p){LC(m,p,"custBookerFlag")}}};var b0={fieldLabel:C_TRTY,tabIndex:5,name:"trtyId",value:bX.get("trtyId"),store:getTRTY_S(),xtype:"combo",displayField:"trtyName",valueField:"trtyId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var bZ={fieldLabel:C_TRADE_CONTRACT_NO,tabIndex:2,name:"consTradeContractNo",value:bX.get("consTradeContractNo"),xtype:"textfield",anchor:"95%"};var bV={fieldLabel:C_INSURANCE_FEE,tabIndex:6,name:"consInsuranceFee",value:bX.get("consInsuranceFee"),xtype:"textfield",anchor:"95%"};var bU={fieldLabel:C_CREDIT_NO,tabIndex:3,name:"consCreditNo",value:bX.get("consCreditNo"),xtype:"textfield",anchor:"95%"};var bT={fieldLabel:C_TRTE,tabIndex:4,name:"trteId",value:bX.get("trteId"),store:getTRTE_S(),xtype:"combo",displayField:"trteName",valueField:"trteId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var aM={title:C_TRADE_INFO,layout:"column",collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[ca,b0]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bZ,bV]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bU]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bT]}]};var bS={fieldLabel:C_HBL_NO,tabIndex:7,name:"consHblNo",value:bX.get("consHblNo"),xtype:"textfield",anchor:"95%"};var bR={fieldLabel:C_SCAC_CODE,tabIndex:8,name:"consScacCode",value:bX.get("consScacCode"),xtype:"textfield",anchor:"95%"};var bQ={fieldLabel:C_BOOK_US_NO,tabIndex:9,name:"consBookingDeclareNoUs",value:bX.get("consBookingDeclareNoUs"),xtype:"textfield",anchor:"95%"};var bP={fieldLabel:C_US_FULLSHIP,tabIndex:10,name:"consUsFullShip",value:bX.get("consUsFullShip"),store:USFU_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var aK={title:C_AMS_INFO,layout:"column",collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bS]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bR]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bQ]},{columnWidth:0.25,layout:"form",border:false,labelWidth:70,items:[bP]}]};var bO={fieldLabel:C_F_SHIPPER,tabIndex:11,name:"consFShipper",value:bX.get("consFShipper"),xtype:"textarea",anchor:"95%"};var bM={fieldLabel:C_F_CONSIGNEE,tabIndex:12,name:"consFConsignee",value:bX.get("consFConsignee"),xtype:"textarea",anchor:"95%"};var bK={fieldLabel:C_F_NOTIFY,tabIndex:13,name:"consFNotifyParty",value:bX.get("consFNotifyParty"),xtype:"textarea",anchor:"95%"};var aG={title:C_FSHIPPER_INFO,layout:"column",collapsible:true,items:[{columnWidth:0.34,layout:"form",border:false,labelWidth:70,items:[bO]},{columnWidth:0.33,layout:"form",border:false,labelWidth:70,items:[bM]},{columnWidth:0.33,layout:"form",border:false,labelWidth:70,items:[bK]}]};var bA={fieldLabel:C_EXT_1,tabIndex:14,name:"attr1",value:bX.get("attr1"),xtype:"textfield",anchor:"95%"};var bz={fieldLabel:C_EXT_3,tabIndex:16,name:"attr3",value:bX.get("attr3"),xtype:"textfield",anchor:"95%"};var by={fieldLabel:C_EXT_5,tabIndex:18,name:"attr5",value:bX.get("attr5"),xtype:"textfield",anchor:"95%"};var bw={fieldLabel:C_EXT_7,tabIndex:20,name:"attr7",value:bX.get("attr7"),xtype:"textfield",anchor:"95%"};var bu={fieldLabel:C_EXT_9,tabIndex:22,name:"attr9",value:bX.get("attr9"),xtype:"textarea",anchor:"95%"};var bs={fieldLabel:C_EXT_2,tabIndex:15,name:"attr2",value:bX.get("attr2"),xtype:"textfield",anchor:"95%"};var bq={fieldLabel:C_EXT_4,tabIndex:17,name:"attr4",value:bX.get("attr4"),xtype:"textfield",anchor:"95%"};var bo={fieldLabel:C_EXT_6,tabIndex:19,name:"attr6",value:bX.get("attr6"),xtype:"textfield",anchor:"95%"};var bl={fieldLabel:C_EXT_8,tabIndex:21,name:"attr8",value:bX.get("attr8"),xtype:"textfield",anchor:"95%"};var bh={fieldLabel:C_EXT_10,tabIndex:23,name:"attr10",value:bX.get("attr10"),xtype:"textarea",anchor:"95%"};var aE={title:C_OTHER_INFO,layout:"column",collapsible:true,items:[{columnWidth:0.5,layout:"form",border:false,labelWidth:70,items:[bA,bz,by,bw,bu]},{columnWidth:0.5,layout:"form",border:false,labelWidth:70,items:[bs,bq,bo,bl,bh]}]};var az={id:"C_B_K_"+bX.get("id"),title:C_EXT_INFO+"(K)",height:450,autoScroll:true,items:bX.get("consBizClass")==BC_E?[aM,aK,aG,aE]:[aM,aE]};var ay={id:"C_B_T_"+bX.get("id"),title:C_HBL_INFO+"(T)",height:450,autoScroll:true,layout:"form",deferredRender:false,collapsible:true,items:[this.hblGrid]};var aJ=[aD,aB,aA,az];if(bX.get("consBizType")==BT_G||bX.get("consBizType")==BT_I){aJ=[aD,aB,az]}else{if(bX.get("consBizType")==BT_C){aJ=[aD,aC,aB,aA,az];if(bX.get("consBizClass")==BC_I){aJ=[aD,aC,aB,ay,aA,az]}}}this.expEmail=function(p,m){var b2="";var b1="";m=m;var bk="";EXPM(b2,b1,m,bk,p,"consId="+bX.get("consId"))};this.expFax=function(p,m){var b2=bX.get("custFax");var b1="";m=m;var bk="";EXPM(b2,b1,m,bk,p,"consId="+bX.get("consId"),3)};this.expExcel=function(m){if(m=="BOOK_C"){EXPC(m,"&expeType=R&consId="+bX.get("consId"))}else{EXPC(m,"&consId="+bX.get("consId"))}};this.updateStatus=function(m){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONS_U",consId:bX.get("consId"),consStatus:m},success:function(p){bX.set("consStatus",m);this.updateToolBar(m);XMG.alert(SYS,M_S);var bk=new Ext.data.Store({url:SERVICE_URL+"?A=CONS_Q",reader:new Ext.data.XmlReader({record:"FConsign"},FConsign)});bk.load({params:{consId:bX.get("consId")},callback:function(b2,b3,b1){if(b1&&b2.length>0){var b4=b2[0];bX.beginEdit();bX.set("version",b4.get("version"));bX.endEdit();XMG.alert(SYS,M_S)}},scope:this})},failure:function(p){XMG.alert(SYS,M_F+p.responseText)}})};this.unlock=function(){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONS_U",consId:bX.get("consId"),consStatusLock:0},success:function(m){bX.set("consStatusLock",0);this.updateToolBar(bX.get("consStatus"));XMG.alert(SYS,M_S);var p=new Ext.data.Store({url:SERVICE_URL+"?A=CONS_Q",reader:new Ext.data.XmlReader({record:"FConsign"},FConsign)});p.load({params:{consId:bX.get("consId")},callback:function(b1,b2,bk){if(bk&&b1.length>0){var b3=b1[0];bX.beginEdit();bX.set("version",b3.get("version"));bX.endEdit();XMG.alert(SYS,M_S)}},scope:this})},failure:function(m){XMG.alert(SYS,M_F+m.responseText)}})};this.start=function(){this.updateStatus("1")};this.check=function(){this.updateStatus("2")};this.exit=function(){this.updateStatus("3")};this.renew=function(){this.updateStatus("4")};this.quit=function(){XMG.confirm(SYS,M_CONS_QUIT_C,function(m){if(m=="yes"){this.updateStatus("5")}},this)};this.rebook=function(){this.updateStatus("1")};this.cancel=function(){XMG.confirm(SYS,M_CONS_CANCEL_C,function(m){if(m=="yes"){this.updateStatus("6")}},this)};this.arrive=function(){XMG.confirm(SYS,M_CONS_ARRIVE_C,function(m){if(m=="yes"){this.updateStatus("1")}},this)};this.release=function(){XMG.confirm(SYS,M_CONS_RELEASE_C,function(m){if(m=="yes"){this.updateStatus("2")}},this)};this.releaseCargo=function(){XMG.confirm(SYS,M_CARGO_RELEASE_C,function(m){if(m=="yes"){this.updateStatus("3")}},this)};this.sendCargo=function(){XMG.confirm(SYS,M_CARGO_SEND_C,function(m){if(m=="yes"){this.updateStatus("4")}},this)};this.copyFrom=function(){XMG.prompt(SYS,C_CONS_NO,function(m,p){if(m=="ok"){var bk=new Ext.data.Store({url:SERVICE_URL+"?A=CONS_Q",reader:new Ext.data.XmlReader({record:"FConsign"},FConsign)});bk.load({params:{consNo:p},callback:function(b4,b6,b3){if(b3&&b4.length>0){var b7=b4[0];bX.beginEdit();var b5=FConsign.prototype.fields;for(var b1=0;b1<b5.keys.length;b1++){var b2=""+b5.keys[b1];if(b2=="consDate"||b2=="id"||b2=="consId"||b2=="consNo"||b2=="version"||b2=="consStatus"||b2=="consStatusBooking"||b2=="consStatusClearance"||b2=="consStatusSwitchBl"||b2=="consStatusSplit"||b2=="consStatusInsp"||b2=="consStatusCont"||b2=="consStatusCarg"||b2=="consStatusMbl"||b2=="consStatusHbl"||b2=="consStatusBBook"||b2=="consStatusDepa"||b2=="consStatusDocs"||b2=="consStatusExp"||b2=="consStatusAud"||b2=="consStatusAr"||b2=="consStatusAp"||b2=="consArWriteOffDate"||b2=="consApWriteOffDate"||b2=="consStatusInvoR"||b2=="consStatusInvoP"||b2=="consInvoRDate"||b2=="consInvoPDate"||b2=="consStatusReassign"||b2=="consStatusInCy"||b2=="consStatusInCfs"||b2=="consStatusOnBoard"||b2=="consStatusEir"||b2=="consStatusSendCont"||b2=="consStatusLock"||b2=="consReassignFrom"||b2=="consStatusSettlement"||b2=="rowAction"||b2=="fconId"||b2=="loliId"||b2=="consMasterFlag"||b2=="consMasterId"||b2=="consMergeFlag"||b2=="consMergeId"||b2=="consMergeNo"||b2=="consMasterNo"||b2=="consContractNo"||b2=="consTradeContractNo"||b2=="consMblNo"||b2=="consHblNo"){}else{bX.set(b2,b7.get(b2))}}bX.endEdit();this.getForm().loadRecord(bX)}},scope:this})}},this)};var q=bX.get("consStatusLock")==1;var aI=bX.get("editable")==0;var bY=getRM(bX.get("consBizClass"),bX.get("consBizType"),bX.get("consShipType"))+M3_CONS;this.updateToolBar=function(p){var m=this.getTopToolbar();q=bX.get("consStatusLock")==1;if(m.getComponent("TB_A")){m.getComponent("TB_A").setDisabled(NR(bY+F_M)||q||aI)}if(m.getComponent("TB_B")){m.getComponent("TB_B").setDisabled(NR(bY+F_M)||q||aI||p!=0)}if(m.getComponent("TB_C")){m.getComponent("TB_C").setDisabled(NR(bY+F_M)||q||aI||p!=1)}if(m.getComponent("TB_D")){m.getComponent("TB_D").setDisabled(NR(bY+F_M)||q||aI||p!=2)}if(m.getComponent("TB_E")){m.getComponent("TB_E").setDisabled(NR(bY+F_M)||q||aI||p!=2)}if(m.getComponent("TB_F")){m.getComponent("TB_F").setDisabled(NR(bY+F_M)||q||aI||p==5)}if(m.getComponent("TB_G")){m.getComponent("TB_G").setDisabled(NR(bY+F_M)||q||aI||p<2)}if(m.getComponent("TB_H")){m.getComponent("TB_H").setDisabled(NR(bY+F_F)||q||aI||p!=2)}if(m.getComponent("TB_I")){m.getComponent("TB_I").setDisabled(NR(bY+F_M)||q||aI||bX.get("consStatus")!=0)}if(m.getComponent("TB_J")){m.getComponent("TB_J").setDisabled(NR(bY+F_M)||q||aI||bX.get("consStatus")!=1)}if(m.getComponent("TB_K")){m.getComponent("TB_K").setDisabled(NR(bY+F_M)||q||aI||bX.get("consStatus")!=2)}if(m.getComponent("TB_L")){m.getComponent("TB_L").setDisabled(NR(bY+F_F)||q||aI||bX.get("consStatus")!=3)}if(m.getComponent("TB_U")){m.getComponent("TB_U").setDisabled(NR(bY+F_UL)||q!=1)}m.getComponent("TB_M").setText(C_STATUS+"："+(bX.get("consBizClass")==BC_I?getCIST(bX.get("consStatus")):getCOST(bX.get("consStatus"))))};var cS={text:C_SAVE+"(S)",itemId:"TB_A",iconCls:"save",disabled:NR(bY+F_M)||q||aI,scope:this,handler:this.save};var cR={text:C_BOOK_START+"(B)",itemId:"TB_B",iconCls:"save",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=0,scope:this,handler:this.start};var cP={text:C_BOOK_CONFIRM+"(Q)",itemId:"TB_C",iconCls:"check",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=1,scope:this,handler:this.check};var cN={text:C_BOOK_EXIT+"(T)",itemId:"TB_D",iconCls:"exit",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=2,scope:this,handler:this.exit};var cK={text:C_BOOK_REASSIGN+"(G)",itemId:"TB_E",iconCls:"redo",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=2,scope:this,handler:this.renew};var cI={text:C_BOOK_QUIT+"(X)",itemId:"TB_F",iconCls:"consCancel",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")==5,scope:this,handler:this.quit};var cH={text:C_BOOK_RENEW+"(R)",itemId:"TB_G",iconCls:"renew",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")<2,scope:this,handler:this.rebook};var cG={text:C_INVALID+"(F)",itemId:"TB_H",iconCls:"cancel",disabled:NR(bY+F_F)||q||aI||bX.get("consStatus")!=2,scope:this,handler:this.cancel};var cF={text:C_COPY+"(A)",itemId:"TB_N",iconCls:"copy",disabled:NR(bY+F_M),scope:this,handler:function(){Fos.showConsign(Fos.copyConsign(bX))}};var c4={text:C_COPY_FROM+"(C)",itemId:"TB_O",iconCls:"copy",disabled:NR(bY+F_M)||q||aI,scope:this,handler:this.copyFrom};var d={text:C_ARRIVE,itemId:"TB_I",iconCls:"plane",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=0,scope:this,handler:this.arrive};var c={text:C_SWITCH_BL,itemId:"TB_J",iconCls:"release",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=1,scope:this,handler:this.release};var b={text:C_RELEASE,itemId:"TB_K",iconCls:"cart",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=2,scope:this,handler:this.releaseCargo};var a={text:C_SEND_CARGO,itemId:"TB_L",iconCls:"cart",disabled:NR(bY+F_M)||q||aI||bX.get("consStatus")!=3,scope:this,handler:this.sendCargo};var c5={text:C_INVALID,itemId:"TB_M",iconCls:"cancel",disabled:NR(bY+F_F)||q||aI,scope:this,handler:this.cancel};var c3={text:C_UNLOCK,itemId:"TB_U",iconCls:"unlock",disabled:NR(bY+F_UL)||q!=1,scope:this,handler:this.unlock};var be=CREATE_E_MENU(M_ARRIVE_ADVICE,function(){this.expExcel("ARAD")},function(){this.expEmail("ARAD",M_ARRIVE_ADVICE)},function(){this.expFax("ARAD",M_ARRIVE_ADVICE)},this);var bb=CREATE_E_MENU(M_BOOK,function(){this.expExcel("CONS_B")},function(){this.expEmail("CONS_B",M_BOOK)},function(){this.expFax("CONS_B",M_BOOK)},this);var a9=CREATE_E_MENU(M_BOOK_CONFIRM,function(){this.expExcel("BOOK_C")},function(){this.expEmail("BOOK_C",M_BOOK_CONFIRM)},function(){this.expFax("BOOK_C",M_BOOK_CONFIRM)},this);var a8=CREATE_E_MENU(M_CONSIGN,function(){this.expExcel("CONS")},function(){this.expEmail("CONS",M_CONSIGN)},function(){this.expFax("CONS",M_CONSIGN)},this);var a7=CREATE_E_MENU(M_BL_ER,function(){this.expExcel("BLER")},function(){this.expEmail("BLER",M_BL_ER)},function(){this.expFax("BLER",M_BL_ER)},this);var a6=CREATE_E_MENU(M_BL_SEAWAY,function(){this.expExcel("SEAW")},function(){this.expEmail("SEAW",M_BL_SEAWAY)},function(){this.expFax("SEAW",M_BL_SEAWAY)},this);var a5=CREATE_E_MENU(M_LOAD_ADVICE,function(){this.expExcel("WARE_INFO")},function(){this.expEmail("WARE_INFO",M_LOAD_ADVICE)},function(){this.expFax("WARE_INFO",M_LOAD_ADVICE)},this);var a4=CREATE_E_MENU(M_SGS_ADVICE,function(){this.expExcel("SGS_INFO")},function(){this.expEmail("SGS_INFO",M_SGS_ADVICE)},function(){this.expFax("SGS_INFO",M_SGS_ADVICE)},this);var a3=CREATE_E_MENU(M_SHIP_ADVICE,function(){this.expExcel("SHIP_INFO")},function(){this.expEmail("SHIP_INFO",M_SHIP_ADVICE)},function(){this.expFax("SHIP_INFO",M_SHIP_ADVICE)},this);var aO=[];if(bX.get("consBizType")==BT_C){aO=bX.get("consBizClass")==BC_I?[be]:[bb,a9,a8,a7,a6,a5,a4,a3]}else{aO=bX.get("consBizClass")==BC_I?[be]:[bb,a9,a7,a6]}var e={text:C_EXPORT,iconCls:"print",disabled:NR(bY+F_E)||q,scope:this,menu:{items:aO}};var cM={itemId:"TB_M",disabled:true,text:C_STATUS+"："+(bX.get("consBizClass")==BC_I?getCIST(bX.get("consStatus")):getCOST(bX.get("consStatus")))};var bW=[];if(bX.get("consBizType")==BT_G||bX.get("consBizType")==BT_I){bW=[cS,"-",cG,"-",cF,"-",c4,"-",c3,"->",cM,"-"]}else{if(bX.get("consBizClass")==BC_I){bW=[cS,"-",d,"-",c,"-",b,"-",a,"-",c5,"-",cF,"-",c4,"-",e,"-",c3,"->",cM,"-"]}else{if(bX.get("consBizClass")==BC_E){bW=[cS,"-",cR,"-",cP,"-",cN,"-",cK,"-",cI,"-",cH,"-",cG,"-",cF,"-",c4,"-",e,"-",c3,"->",cM,"-"]}}}var ci=new Ext.KeyMap(Ext.getDoc(),{key:"sbqtgxrfac",ctrl:true,handler:function(bk,b1){var m=T_MAIN.getComponent("C_"+bX.get("id"));if(m&&m==T_MAIN.getActiveTab()){var p=m.getComponent("T_BOOK_"+bX.get("id"));if(p&&p==m.getActiveTab()){p=this.getTopToolbar();switch(bk){case Ext.EventObject.S:if(!p.getComponent("TB_A").disabled){this.save()}break;case Ext.EventObject.B:if(!p.getComponent("TB_B").disabled){this.start()}break;case Ext.EventObject.Q:if(!p.getComponent("TB_C").disabled){this.check()}break;case Ext.EventObject.T:if(!p.getComponent("TB_D").disabled){this.exit()}break;case Ext.EventObject.G:if(!p.getComponent("TB_E").disabled){this.renew()}break;case Ext.EventObject.X:if(!p.getComponent("TB_F").disabled){this.quit()}break;case Ext.EventObject.R:if(!p.getComponent("TB_G").disabled){this.rebook()}break;case Ext.EventObject.F:if(!p.getComponent("TB_H").disabled){this.cancel()}break;case Ext.EventObject.A:if(!p.getComponent("TB_N").disabled){Fos.showConsign(Fos.copyConsign(bX))}break;case Ext.EventObject.C:if(!p.getComponent("TB_O").disabled){this.copyFrom()}break}}}},stopEvent:true,scope:this});new Ext.KeyMap(Ext.getDoc(),{key:"jxhykt",alt:true,handler:function(b1,b3){var p=T_MAIN.getComponent("C_"+bX.get("id"));if(p&&p==T_MAIN.getActiveTab()){var bk=p.getComponent("T_BOOK_"+bX.get("id"));var m=bk.getComponent("T_BOOK_T_"+bX.get("id"));if(bk==p.getActiveTab()){switch(b1){case Ext.EventObject.J:var b2=m.getComponent("C_B_J_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break;case Ext.EventObject.X:var b2=m.getComponent("C_B_X_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break;case Ext.EventObject.H:var b2=m.getComponent("C_B_H_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break;case Ext.EventObject.Y:var b2=m.getComponent("C_B_Y_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break;case Ext.EventObject.K:var b2=m.getComponent("C_B_K_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break;case Ext.EventObject.T:var b2=m.getComponent("C_B_T_"+bX.get("id"));if(b2){m.setActiveTab(b2)}break}}}},stopEvent:true});Fos.BookTab.superclass.constructor.call(this,{id:"T_BOOK_"+bX.get("id"),title:C_CONSIGN+"(F1)",header:false,deferredRender:false,autoScroll:true,border:false,labelAlign:"right",bodyStyle:"padding:2px 10px 10px 2px",tbar:bW,items:[{id:"T_BOOK_T_"+bX.get("id"),xtype:"tabpanel",plain:true,activeTab:0,listeners:{scope:this,tabchange:function(p,bk){bk.doLayout()}},items:aJ}]})};Ext.extend(Fos.BookTab,Ext.FormPanel);Fos.TransTab=function(U){this.tranId=0;this.sel=GSEL;var e=new Ext.form.TextField({name:"tranTotalPackages",disabled:true});var V=new Ext.form.TextField({name:"tranTotalGrossWeight",disabled:true});var ae=new Ext.form.TextField({name:"tranTotalMeasurement",disabled:true});this.addKeyMap=function(){var m=new Ext.KeyMap(this.el,[{key:"a",ctrl:true,fn:function(){this.addTrans()},scope:this},{key:"d",ctrl:true,fn:function(){this.removeTrans()},scope:this},{key:"s",ctrl:true,fn:function(){this.save()},scope:this},{key:"e",ctrl:true,fn:function(){},scope:this}]);m.stopEvent=true};this.store=GS("TRAN_Q","FTrans",FTrans,"tranId","DESC","","","id",false);this.taskStore=GS("TRTA_Q","FTransTask",FTransTask,"trtaId","DESC","","","id",false);this.cargoStore=GS("TRCA_Q","FTransCargo",FTransCargo,"trcaId","DESC","","","id",false);if(U.get("rowAction")!="N"){this.store.load({params:{consId:U.get("consId")}});this.taskStore.load({params:{consId:U.get("consId")}});this.cargoStore.load({params:{consId:U.get("consId")}})}var T={scope:this,rowselect:function(ak,aj,af){if(this.sel!=af.get("tranId")){this.sel=af.get("tranId");this.getForm().reset();this.getForm().loadRecord(af);e.setValue(af.get("tranTotalPackages"));V.setValue(af.get("tranTotalGrossWeight"));ae.setValue(af.get("tranTotalMeasurement"));var p=this.taskStore.getRange();var ai=this.taskGrid.getStore();ai.removeAll();for(var ag=0;ag<p.length;ag++){if(p[ag].get("tranId")==this.sel){ai.add(p[ag])}}var m=this.cargoStore.getRange();var ah=this.cargoGrid.getStore();ah.removeAll();for(var ag=0;ag<m.length;ag++){if(m[ag].get("tranId")==this.sel){ah.add(m[ag])}}}},rowdeselect:function(m,af,p){if(this.getForm().isDirty()){p.beginEdit();this.getForm().updateRecord(p);p.endEdit()}}};var y=new Ext.grid.CheckboxSelectionModel({singleSelect:true,scope:this,listeners:T});var B=new Ext.grid.ColumnModel({columns:[y,{header:C_TRAN_NO,dataIndex:"tranNo",width:100},{header:C_CONTRACT_NO,dataIndex:"tranContractNo",width:150},{header:C_DATE,dataIndex:"tranDate",renderer:formatDate,width:100},{header:C_TRACK_VENDOR,dataIndex:"tranVendorName",width:100},{header:C_TRACK_CONTACT,dataIndex:"tranVendorContact",width:100},{header:C_TRACK_TEL,dataIndex:"tranVendorTel",width:100},{header:C_STATUS,dataIndex:"tranStatus",renderer:getTRST,width:100}],defaults:{sortable:true,width:100}});this.tranGrid=new Ext.grid.GridPanel({header:false,border:true,height:150,viewConfig:{forceFit:true},autoScroll:true,store:this.store,sm:y,cm:B});var D=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var A=new Ext.grid.ColumnModel({columns:[D,{header:C_COTY,dataIndex:"cotyId",width:100,renderer:getCOTY,editor:new Ext.form.ComboBox({displayField:"cotyCode",valueField:"cotyId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getCOTY_S()})},{header:C_CONT_NO,dataIndex:"trtaContainerNo",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_SEAL_NO,dataIndex:"trtaSealNo",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_ARRIVE_TIME_D,dataIndex:"trtaArriveTimeDemand",width:80,renderer:formatDateTime,editor:new Ext.form.DateField({format:"Y-m-d H:i"})},{header:C_ARRIVE_TIME_F,dataIndex:"trtaArriveTime",width:80,renderer:formatDateTime,editor:new Ext.form.DateField({format:"Y-m-d H:i"})},{header:C_LOAD_TIME,dataIndex:"trtaLoadTime",width:80,renderer:formatDateTime,editor:new Ext.form.DateField({format:"Y-m-d H:i"})},{header:C_LEAVE_TIME,dataIndex:"trtaLeaveTime",width:80,renderer:formatDateTime,editor:new Ext.form.DateField({format:"Y-m-d H:i"})},{header:C_BACK_TIME,dataIndex:"trtaBackTime",width:80,renderer:formatDateTime,editor:new Ext.form.DateField({format:"Y-m-d H:i"})},{header:C_DRIVER,dataIndex:"trtaDriver",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_DRIVER_TEL,dataIndex:"trtaDriverTel",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_TRACK_NO,dataIndex:"trtaTrackNo",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_REMARKS,dataIndex:"trtaRemarks",width:100,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})}],defaults:{sortable:true,width:100}});this.taskGrid=new Ext.grid.EditorGridPanel({border:true,height:150,autoScroll:true,sm:D,cm:A,store:new Ext.data.Store({reader:new Ext.data.XmlReader({id:"trtaId",record:"FTransTask"},FTransTask),pruneModifiedRecords:true,sortInfo:{field:"trtaId",direction:"ASC"}}),tbar:[{text:C_ADD,iconCls:"add",scope:this,handler:function(){var af=this.tranGrid.getSelectionModel().getSelected();if(af){var p=GGUID();var m=new FTransTask({id:p,trtaId:p,tranId:af.get("tranId"),consId:af.get("consId"),cotyId:"",trtaContainerNo:"",trtaSealNo:"",trtaArriveTimeDemand:"",trtaArriveTime:"",trtaLoadTime:"",trtaLeaveTime:"",trtaBackTime:"",trtaDriver:"",trtaDriverTel:"",trtaTrackNo:"",trtaRemarks:"",version:0});this.taskStore.add(m);m.set("rowAction","N");this.taskGrid.getStore().insert(0,m);this.taskGrid.startEditing(0,1)}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}}},"-",{text:C_REMOVE,iconCls:"remove",scope:this,handler:function(){FOS_REMOVE(D,this.taskGrid.getStore())}}]});var C=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var z=new Ext.grid.ColumnModel({columns:[D,{header:C_CATY,dataIndex:"trcaCargoName",width:80,editor:new Ext.form.TextField({})},{header:C_PACK,dataIndex:"packId",width:80,renderer:getPACK,editor:new Ext.form.ComboBox({displayField:"packName",valueField:"packId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getPACK_S(),listeners:{scope:this,select:function(af,p,m){this.cargoGrid.getSelectionModel().getSelected().set("packName",p.get("packName"))}}})},{header:C_PACKAGES,dataIndex:"trcaPackageNum",width:60,editor:new Ext.form.NumberField({allowBlank:false})},{header:C_GW,dataIndex:"trcaGrossWeight",width:60,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_SIZE,dataIndex:"trcaMeasurement",width:60,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_REMARKS,dataIndex:"trcaRemarks",width:100,editor:new Ext.form.TextField()}],defaults:{sortable:true,width:100}});this.cargoGrid=new Ext.grid.EditorGridPanel({border:true,height:150,autoScroll:true,sm:C,cm:z,store:new Ext.data.Store({reader:new Ext.data.XmlReader({id:"trcaId",record:"FTransCargo"},FTransTask),pruneModifiedRecords:true,sortInfo:{field:"trcaId",direction:"ASC"}}),listeners:{scope:this,afteredit:function(p){var m=p.field;if(m=="trcaPackageNum"||m=="trcaGrossWeight"||m=="trcaMeasurement"){this.reCalculate()}}},tbar:[{text:C_ADD,iconCls:"add",scope:this,handler:function(){var m=this.tranGrid.getSelectionModel().getSelected();if(m){var p=new Fos.CargoLookupWin("CARG_Q",U.get("consId"));p.addButton({text:C_OK,scope:this,handler:function(){var ai=p.findById("G_CARG_LOOKUP");var af=ai.getSelectionModel().getSelections();if(af){for(var ah=0;ah<af.length;ah++){if(this.cargoGrid.getStore().findBy(function(aj,ak){return aj.get("cargId")==af[ah].get("cargId")})==-1){var ag=new FTransCargo({id:GGUID(),trcaId:"0",tranId:m.get("tranId"),consId:m.get("consId"),cargId:af[ah].get("cargId"),trcaCargoName:af[ah].get("cargNameEn"),packId:af[ah].get("packId"),packName:getPACK(af[ah].get("packId")),trcaPackageNum:af[ah].get("cargPackageNum"),trcaGrossWeight:af[ah].get("cargGrossWeight"),trcaMeasurement:af[ah].get("cargMeasurement"),trcaRemarks:"",verson:0});this.cargoStore.add(ag);ag.set("rowAction","N");this.cargoGrid.getStore().add(ag)}}this.reCalculate()}p.close()}},this);p.addButton({text:C_CANCEL,handler:function(){p.close()}},this);p.show()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}}},"-",{text:C_REMOVE,iconCls:"remove",scope:this,handler:function(){var p=this.cargoGrid.getSelectionModel().getSelections();if(p.length){for(var m=0;m<p.length;m++){p[m].set("rowAction",p[m].get("rowAction")=="N"?"D":"R");this.cargoGrid.getStore().remove(p[m]);this.reCalculate()}}else{XMG.alert(SYS,M_R_P)}}},"->",{xtype:"tbtext",text:C_SUM_PACK},e,"-",{xtype:"tbtext",text:C_SUM_GW},V,"-",{xtype:"tbtext",text:C_SUM_CBM},ae]});this.reCalculate=function(){var ah=0;var ag=0;var ai=0;var p=this.cargoGrid.getStore().getRange();for(var af=0;af<p.length;af++){if(p[af].get("trcaPackageNum")>0){ah+=parseInt(p[af].get("trcaPackageNum"))}if(p[af].get("trcaGrossWeight")>0){ag+=parseFloat(p[af].get("trcaGrossWeight"))}if(p[af].get("trcaMeasurement")>0){ai+=parseFloat(p[af].get("trcaMeasurement"))}}e.setValue(ah);V.setValue(ag);ae.setValue(ai);var m=this.tranGrid.getSelectionModel().getSelected();m.beginEdit();m.set("tranTotalPackages",ah);m.set("tranTotalGrossWeight",ag);m.set("tranTotalMeasurement",ai);m.endEdit()};this.addTrans=function(){this.tranId=this.tranId-1;var m=new FTrans({id:this.tranId,tranId:this.tranId,consId:U.get("consId"),consNo:U.get("consNo"),tranDate:new Date(),tranExpiryDate:U.get("consExpiryDate"),tranVendorId:U.get("consTrackVendor"),tranVendorName:U.get("consTrackVendorName"),tranVendorContact:U.get("consTrackContact"),tranVendorTel:U.get("consTrackTel"),tranLoadDate:U.get("consTrackLoadDate"),tranLoadAddress:U.get("consTrackLoadAddress"),tranContainerCompany:U.get("consContainerCompany"),tranRemarks:U.get("consTrackRemarks"),tranLoadContact:U.get("custContact"),tranLoadTel:U.get("custTel"),tranContainerNo:U.get("consTotalContainers"),tranVessel:U.get("vessName"),tranVoyage:U.get("voyaName"),tranSoNo:U.get("consSoNo"),tranPol:U.get("consPolEn"),tranStatus:"0",version:"0"});this.store.insert(0,m);m.set("rowAction","N");this.tranGrid.getSelectionModel().selectFirstRow()};this.removeTrans=function(){var m=this.tranGrid.getSelectionModel().getSelected();if(m){if(m.get("tranStatus")!="0"){XMG.alert(SYS,M_TRAN_CONFIRMED)}else{m.set("rowAction",m.get("rowAction")=="N"?"D":"R");this.store.remove(m);var ai=this.taskGrid.getStore();var af=ai.getRange();for(var ag=0;ag<af.length;ag++){af[ag].set("rowAction",af[ag].get("rowAction")=="N"?"D":"R");this.taskStore.remove(af[ag]);ai.remove(af[ag])}var ah=this.cargoGrid.getStore();var p=ah.getRange();for(var ag=0;ag<p.length;ag++){p[ag].set("rowAction",p[ag].get("rowAction")=="N"?"D":"R");this.cargoStore.remove(p[ag]);ah.remove(p[ag])}this.getForm().reset()}}else{XMG.alert(SYS,M_R_P)}};this.save=function(){this.taskGrid.stopEditing();this.cargoGrid.stopEditing();var ah=this.tranGrid.getSelectionModel().getSelected();if(ah){ah.beginEdit();this.getForm().updateRecord(ah);ah.endEdit()}var ai=this.store.getModifiedRecords();if(ai.length>0){var ag=ATX(ai,"FTrans",FTrans)}var m=[];var p=this.taskStore.getRange();for(var af=0;af<p.length;af++){if(p[af].dirty){m[m.length]=p[af]}}if(m.length>0){var aj=ATX(m,"FTransTask",FTransTask);ag=ag+aj}var ak=[];var al=this.cargoStore.getRange();for(var af=0;af<al.length;af++){if(al[af].dirty){ak[ak.length]=al[af]}}if(ak.length>0){var aj=ATX(ak,"FTransCargo",FTransCargo);ag=ag+aj}if(ag!=""){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"TRAN_S"},success:function(ao){var an=XTRA(ao.responseXML,"FTrans",FTrans);FOSU(this.store,an,FTrans);var am=XTRA(ao.responseXML,"FTransTask",FTransTask);FOSU(this.taskStore,am,FTransTask);var ap=XTRA(ao.responseXML,"FTransCargo",FTransCargo);FOSU(this.cargoStore,ap,FTransCargo);XMG.alert(SYS,M_S)},failure:function(am){XMG.alert(SYS,M_F+am.responseText)},xmlData:FOSX(ag)})}else{XMG.alert(SYS,M_NC)}};this.expExcelTR=function(){var m=this.tranGrid.getSelectionModel().getSelected();if(m){EXPC("TRAN","&tranId="+m.get("tranId"))}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.expEmailTR=function(){var m=this.tranGrid.getSelectionModel().getSelected();if(m){var ah="";var ag="";var p="";var af="";EXPM(ah,ag,p,af,"TRAN","tranId="+m.get("tranId"))}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.updateStatus=function(p){var m=this.tranGrid.getSelectionModel().getSelected();if(m){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"TRAN_U",tranId:m.get("tranId"),tranStatus:p},success:function(af){m.set("tranStatus",p);this.updateToolbar();XMG.alert(SYS,M_S)},failure:function(af){XMG.alert(SYS,M_F+af.responseText)}})}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.start=function(){this.updateStatus("1")};this.end=function(){this.updateStatus("2")};var W=getRM(U.get("consBizClass"),U.get("consBizType"),U.get("consShipType"))+M3_TRAN;var v={fieldLabel:HL(C_TRACK_VENDOR),name:"tranVendorName",tabIndex:1,store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();U.set("tranVendorId","");U.set("tranVendorName","")}},select:function(ag,af,p){this.find("name","tranVendorContact")[0].setValue(af.get("custContact"));this.find("name","tranVendorTel")[0].setValue(af.get("custTel"));this.find("name","tranVendorFax")[0].setValue(af.get("custFax"));var m=this.tranGrid.getSelectionModel().getSelected();if(m){m.set("tranVendorName",af.get("custNameCn"));m.set("tranVendorId",af.get("custId"));m.set("tranVendorContact",af.get("custContact"));m.set("tranVendorTel",af.get("custTel"))}},keydown:{fn:function(m,p){LC(m,p,"custTrackFlag")},buffer:BF}}};var s={fieldLabel:C_LOAD_TIME,name:"tranLoadDate",tabIndex:26,xtype:"datefield",format:DATEF,anchor:"95%"};var q={fieldLabel:C_LOAD_FACTORY,name:"tranLoadFactory",tabIndex:9,xtype:"textfield",anchor:"95%"};var n={fieldLabel:C_LOAD_ADDRESS,name:"tranLoadAddress",tabIndex:13,xtype:"textfield",anchor:"95%"};var k={fieldLabel:C_VESS,name:"tranVessel",tabIndex:21,xtype:"textfield",anchor:"95%"};var i={fieldLabel:C_DRAW_CY,name:"tranCyDraw",tabIndex:25,xtype:"textfield",anchor:"95%"};var g={fieldLabel:C_TRAN_CONTACT,name:"tranVendorContact",tabIndex:2,xtype:"textfield",anchor:"95%"};var f={fieldLabel:C_CONTRACT_NO,name:"tranContractNo",tabIndex:6,xtype:"textfield",anchor:"95%"};var d={fieldLabel:C_TRACK_CONTACT,name:"tranLoadContact",tabIndex:10,xtype:"textfield",anchor:"95%"};var c={fieldLabel:C_DELIVERY_ADDRESS,name:"tranDeliveryAddress",tabIndex:14,xtype:"textfield",anchor:"95%"};var b={fieldLabel:C_OP_TYPE,name:"tranOperationType",tabIndex:17,store:TROT_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"};var a={fieldLabel:C_VOYA,name:"tranVoyage",tabIndex:22,xtype:"textfield",anchor:"95%"};var ad={fieldLabel:C_DRAW_DATE,name:"tranDrawDate",tabIndex:26,xtype:"datefield",format:DATEF,anchor:"95%"};var ac={fieldLabel:C_TRAN_TEL,name:"tranVendorTel",tabIndex:3,xtype:"textfield",anchor:"95%"};var ab={fieldLabel:C_CONS_DATE,name:"tranDate",tabIndex:7,xtype:"datefield",format:DATEF,anchor:"95%"};var aa={fieldLabel:C_TRACK_TEL,name:"tranLoadTel",tabIndex:11,xtype:"textfield",anchor:"95%"};var Z={fieldLabel:C_CONTAINER,name:"tranContainerCompanyName",tabIndex:15,store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,select:function(ag,af,p){var m=this.tranGrid.getSelectionModel().getSelected();if(m){m.set("tranContainerCompany",af.get("custId"))}},keydown:{fn:function(m,p){LC(m,p,"custContainerFlag")},buffer:BF}}};var Y={fieldLabel:C_MILES,name:"tranHeavyMiles",tabIndex:27,xtype:"numberfield",anchor:"95%"};var S={fieldLabel:U.get("consBizClass")==BC_E?C_POL:C_POD,tabIndex:23,name:"tranPol",xtype:"textfield",anchor:"95%"};var R={fieldLabel:C_BACK_CY,name:"tranCyBack",tabIndex:27,xtype:"textfield",anchor:"95%"};var Q={fieldLabel:C_TRAN_FAX,name:"tranVendorFax",tabIndex:4,xtype:"textfield",anchor:"90%"};var O={fieldLabel:C_TRAN_DATE,name:"tranStartDate",tabIndex:26,xtype:"datefield",format:DATEF,anchor:"90%"};var M={fieldLabel:C_LOAD_PLACE,name:"tranLoadPlace",tabIndex:12,xtype:"textfield",anchor:"90%"};var K={fieldLabel:C_CONT_INFO,name:"tranContainerInfo",tabIndex:16,xtype:"textfield",allowDecimals:false,anchor:"90%"};var J={fieldLabel:U.get("consBizClass")==BC_E?C_CUSTOM_EXPIRY_DATE:C_ETA,tabIndex:8,name:"tranExpiryDate",xtype:"datefield",format:DATEF,anchor:"90%"};var I={fieldLabel:U.get("consBizClass")==BC_E?"S/O No.":C_MBL_NO,name:"tranSoNo",tabIndex:24,xtype:"textfield",anchor:"90%"};var H={fieldLabel:C_BACK_DATE,name:"tranBackDate",tabIndex:28,xtype:"datefield",format:DATEF,anchor:"90%"};var G={layout:"column",title:C_TRAN_INFO,layoutConfig:{columns:4},deferredRender:false,collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,items:[v,s,q,n,k,i]},{columnWidth:0.25,layout:"form",border:false,labelWidth:90,items:[g,f,d,c,b,a,ad]},{columnWidth:0.25,layout:"form",border:false,items:[ac,ab,aa,Z,Y,S,R]},{columnWidth:0.25,layout:"form",border:false,items:[Q,O,M,K,J,I,H]}]};var x={fieldLabel:C_CUSTOM_AGENCY,name:"tranCustomsBrokerName",tabIndex:17,store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();U.set("tranCustomsBroker","");U.set("tranCustomsBrokerName","")}},select:function(ag,af,p){this.find("name","tranCustomsContact")[0].setValue(af.get("custContact"));this.find("name","tranCustomsTel")[0].setValue(af.get("custTel"));this.find("name","tranCustomsAddress")[0].setValue(af.get("custAddress"));var m=this.tranGrid.getSelectionModel().getSelected();if(m){m.set("tranCustomsBroker",af.get("custId"))}},keydown:{fn:function(m,p){LC(m,p,"custCustomFlag")},buffer:BF}}};var w={fieldLabel:C_CUSTOMS_CONTACT,name:"tranCustomsContact",tabIndex:18,xtype:"textfield",anchor:"90%"};var u={fieldLabel:C_CUSTOMS_ADDRESS,tabIndex:20,name:"tranCustomsAddress",xtype:"textfield",anchor:"95%"};var t={fieldLabel:C_CUSTOMS_TEL,name:"tranCustomsTel",tabIndex:19,xtype:"textfield",anchor:"90%"};var F={layout:"column",title:C_TRAN_CUSTOMS_INFO,layoutConfig:{columns:2},deferredRender:false,collapsible:true,items:[{columnWidth:0.5,layout:"form",border:false,labelWidth:100,items:[x]},{columnWidth:0.5,layout:"form",border:false,labelWidth:100,items:[w]},{columnWidth:0.5,layout:"form",border:false,labelWidth:100,items:[u]},{columnWidth:0.5,layout:"form",border:false,labelWidth:100,items:[t]}]};var r={fieldLabel:C_TRAN_TYPE,name:"tranType",tabIndex:17,store:TANT_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"90%"};var o={fieldLabel:C_PRE_FLAG,name:"tranPreFlag",tabIndex:19,xtype:"checkbox",anchor:"60%"};var l={fieldLabel:C_VEHT,name:"tranVehicleType",tabIndex:17,store:getVEHT_S(),xtype:"combo",displayField:"vehtName",valueField:"vehtId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"90%"};var j={fieldLabel:C_INSP_FLAG,name:"tranInspFlag",tabIndex:19,xtype:"checkbox",anchor:"60%"};var h={fieldLabel:C_IC_FLAG,name:"tranIcFlag",tabIndex:19,xtype:"checkbox",anchor:"60%"};var P={fieldLabel:C_REAL_FLAG,name:"tranRearFlag",tabIndex:19,xtype:"checkbox",anchor:"60%"};var N={fieldLabel:C_IC_DAYS,tabIndex:20,name:"tranIcDays",xtype:"numberfield",anchor:"90%"};var L={fieldLabel:C_CONT_FLAG,name:"tranContFlag",tabIndex:19,xtype:"checkbox",anchor:"60%"};var E={layout:"column",title:C_OTHER_INFO,layoutConfig:{columns:4},deferredRender:false,collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,items:[r,o]},{columnWidth:0.25,layout:"form",border:false,items:[l,j]},{columnWidth:0.25,layout:"form",border:false,items:[h,P]},{columnWidth:0.25,layout:"form",border:false,items:[N,L]}]};var X=CREATE_E_MENU(C_TRANS_BILL,this.expExcelTR,this.expEmailTR,function(){},this);new Ext.KeyMap(Ext.getDoc(),{key:"nrskwe",ctrl:true,handler:function(p,af){var m=T_MAIN.getComponent("C_"+U.get("id"));if(m&&m==T_MAIN.getActiveTab()){var ag=m.getComponent("T_TRAN_"+U.get("id"));if(ag==m.getActiveTab()){switch(p){case Ext.EventObject.N:if(!NR(W+F_M)){this.addTrans()}break;case Ext.EventObject.R:if(!NR(W+F_R)){this.removeTrans()}break;case Ext.EventObject.S:if(!NR(W+F_M)){this.save()}break;case Ext.EventObject.K:if(!NR(W+F_M)){this.start()}break;case Ext.EventObject.W:if(!NR(W+F_M)){this.end()}break;case Ext.EventObject.E:if(!NR(W+F_M)){this.expExcelTR()}break}}}},stopEvent:true,scope:this});this.updateToolbar=function(){var m=this.tranGrid.getSelectionModel().getSelected();var p=this.getTopToolbar();var af=m.get("tranStatus");if(m){p.getComponent("TB_A").setDisabled(NR(W+F_M));p.getComponent("TB_B").setDisabled(NR(W+F_R)||af!="0");p.getComponent("TB_C").setDisabled(NR(W+F_M)||af!="0");p.getComponent("TB_D").setDisabled(NR(W+F_M)||af!="0");p.getComponent("TB_E").setDisabled(NR(W+F_M)||af!=1)}};Fos.TransTab.superclass.constructor.call(this,{id:"T_TRAN_"+U.get("id"),title:C_SR_TRAN+"(F4)",header:false,autoScroll:true,labelAlign:"right",labelWidth:80,border:true,layout:"border",tbar:[{text:C_ADD+"(N)",itemId:"TB_A",iconCls:"add",disabled:NR(W+F_M),scope:this,handler:this.addTrans},"-",{text:C_REMOVE+"(R)",itemId:"TB_B",iconCls:"remove",disabled:NR(W+F_R),scope:this,handler:this.removeTrans},"-",{text:C_SAVE+"(S)",itemId:"TB_C",iconCls:"save",disabled:NR(W+F_M),scope:this,handler:this.save},"-",{text:C_START+"(K)",itemId:"TB_D",iconCls:"save",disabled:NR(W+F_M),scope:this,handler:this.start},"-",{text:C_END+"(W)",itemId:"TB_E",iconCls:"check",disabled:NR(W+F_M),scope:this,handler:this.end},"-",{text:C_EXPORT+"(E)",iconCls:"print",disabled:NR(W+F_E),scope:this,menu:{items:[X]}}],items:[{layout:"fit",region:"north",title:C_TRAN_LIST,border:false,height:150,collapsible:true,items:[this.tranGrid]},{xtype:"tabpanel",region:"center",plain:true,activeTab:0,defaults:{bodyStyle:"padding:0px"},autoScroll:true,listeners:{scope:this,tabchange:function(p,af){af.doLayout()}},items:[{title:C_TRAN_INFO,tabIndex:1,autoScroll:true,items:U.get("consBizClass")==BC_E?[G,F,E]:[G,E]},{layout:"fit",border:false,title:C_TASK_LIST,items:[this.taskGrid]},{layout:"fit",border:false,title:C_CARGO_LIST,items:[this.cargoGrid]}]}]})};Ext.extend(Fos.TransTab,Ext.FormPanel);Fos.WarehouseTab=function(c){this.wareId=0;this.sel=GSEL;this.addKeyMap=function(){var m=new Ext.KeyMap(this.el,[{key:"a",ctrl:true,fn:this.addWare,scope:this},{key:"d",ctrl:true,fn:this.removeWare,scope:this},{key:"s",ctrl:true,fn:this.save,scope:this},{key:"e",ctrl:true,fn:function(){},scope:this}]);m.stopEvent=true};this.store=GS("WARE_Q","FWarehouse",FWarehouse,"wareId","DESC","","","id",false);this.cargoStore=GS("WACA_Q","FWarehouseCargo",FWarehouseCargo,"wacaId","DESC","","","id",false);if(c.get("rowAction")!="N"){this.store.load({params:{consId:c.get("consId")}});this.cargoStore.load({params:{consId:c.get("consId")}})}var l={scope:this,rowselect:function(r,q,n){if(this.sel!=n.get("wareId")){this.sel=n.get("wareId");this.getForm().reset();this.getForm().loadRecord(n);b.setValue(n.get("wareTotalPackages"));h.setValue(n.get("wareTotalGrossWeight"));a.setValue(n.get("wareTotalMeasurement"));var p=this.cargoGrid.getStore();p.removeAll();var m=this.cargoStore.getRange();for(var o=0;o<m.length;o++){if(m[o].get("wareId")==this.sel){p.add(m[o])}}}},rowdeselect:function(o,n,m){if(this.getForm().isDirty()){m.beginEdit();this.getForm().updateRecord(m);m.endEdit()}}};var b=new Ext.form.TextField({name:"tranTotalPackages",disabled:true});var h=new Ext.form.TextField({name:"tranTotalGrossWeight",disabled:true});var a=new Ext.form.TextField({name:"tranTotalMeasurement",disabled:true});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true,scope:this,listeners:l});var j=new Ext.grid.ColumnModel({columns:[f,{header:C_WARE_NO,dataIndex:"wareNo",width:100},{header:C_WARE_TYPE,dataIndex:"wareType",renderer:getWATY,width:150},{header:C_WARE_DATE,dataIndex:"wareDate",renderer:formatDate,width:100},{header:C_WAREHOUSE,dataIndex:"wareVendorName",width:100},{header:C_WARE_ACCEPT_STATUS,dataIndex:"wareAcceptStatus",renderer:getWAST,width:100},{header:C_WARE_ACCEPT_TIME,dataIndex:"wareAcceptDate",renderer:formatDate,width:100}],defaults:{sortable:true,width:100}});this.wareGrid=new Ext.grid.GridPanel({header:false,border:true,height:150,viewConfig:{forceFit:true},autoScroll:true,store:this.store,sm:f,cm:j});var k=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var g=new Ext.grid.ColumnModel({columns:[k,{header:C_MARKS,dataIndex:"wacaCargoMarks",width:100,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_CATY,dataIndex:"wacaCargoName",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_PACKAGES,dataIndex:"wacaPackagesNum",width:80,editor:new Ext.form.NumberField({allowBlank:false,allowDecimals:false,blankText:"",invalidText:""})},{header:C_PACK,dataIndex:"packId",width:80,renderer:getPACK,editor:new Ext.form.ComboBox({displayField:"packName",valueField:"packId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getPACK_S(),listeners:{scope:this,select:function(o,n,m){this.cargoGrid.getSelectionModel().getSelected().set("packName",n.get("packName"))}}})},{header:C_GW,dataIndex:"wacaGrossWeight",width:80,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_NW,dataIndex:"wacaNetWeight",width:80,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_CBM,dataIndex:"wacaMeasurement",width:80,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})}],defaults:{sortable:true,width:100}});this.cargoGrid=new Ext.grid.EditorGridPanel({border:false,height:200,autoScroll:true,sm:k,cm:g,store:new Ext.data.Store({reader:new Ext.data.XmlReader({id:"wacaId",record:"FWarehouseCargo"},FWarehouseCargo),sortInfo:{field:"wacaId",direction:"ASC"}}),listeners:{scope:this,afteredit:function(o){var n=o.field;var m=o.record;if(n=="wacaPackagesNum"||n=="wacaGrossWeight"||n=="wacaMeasurement"){this.reCalculate()}}},tbar:[{text:C_ADD,iconCls:"add",scope:this,handler:function(){var m=this.wareGrid.getSelectionModel().getSelected();if(m){var n=new Fos.CargoLookupWin("CARG_Q",c.get("consId"));n.addButton({text:C_OK,scope:this,handler:function(){var s=n.findById("G_CARG_LOOKUP");var o=s.getSelectionModel().getSelections();if(o){for(var q=0;q<o.length;q++){if(this.cargoGrid.getStore().findBy(function(t,u){return t.get("cargId")==o[q].get("cargId")})==-1){var r=GGUID();var p=new FWarehouseCargo({id:r,wacaId:r,wareId:m.get("wareId"),consId:m.get("consId"),cargId:o[q].get("cargId"),wacaCargoName:o[q].get("cargNameEn"),wacaCargoMarks:o[q].get("cargMarks"),packId:o[q].get("packId"),packName:getPACK(o[q].get("packId")),wacaPackagesNum:o[q].get("cargPackageNum"),wacaGrossWeight:o[q].get("cargGrossWeight"),wacaNetWeight:o[q].get("cargNetWeight"),wacaMeasurement:o[q].get("cargMeasurement"),trcaRemarks:"",verson:0});this.cargoStore.add(p);p.set("rowAction","N");this.cargoGrid.getStore().add(p)}}this.reCalculate()}n.close()}},this);n.addButton({text:C_CANCEL,handler:function(){n.close()}},this);n.show()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}}},"-",{text:C_REMOVE,iconCls:"remove",scope:this,handler:function(){var n=this.cargoGrid.getSelectionModel().getSelections();if(n){for(var m=0;m<n.length;m++){n[m].set("rowAction",n[m].get("rowAction")=="N"?"D":"R");this.cargoGrid.getStore().remove(n[m]);this.reCalculate()}}}},"->",{xtype:"tbtext",text:C_SUM_PACK},b,"-",{xtype:"tbtext",text:C_SUM_GW},h,"-",{xtype:"tbtext",text:C_SUM_CBM},a]});this.reCalculate=function(){var q=0,p=0,r=0;var n=this.cargoStore.getRange();for(var o=0;o<n.length;o++){if(n[o].get("wacaPackagesNum")>0){q=q+n[o].get("wacaPackagesNum")}if(n[o].get("wacaGrossWeight")>0){p=p+n[o].get("wacaGrossWeight")}if(n[o].get("wacaMeasurement")>0){r=r+n[o].get("wacaMeasurement")}}b.setValue(round2(q));h.setValue(round2(p));a.setValue(round2(r));var m=this.wareGrid.getSelectionModel().getSelected();m.set("wareTotalPackages",q);m.set("wareTotalGrossWeight",q);m.set("wareTotalMeasurement",q)};this.addWare=function(){this.wareId=this.wareId-1;var m=new FWarehouse({id:this.wareId,wareId:this.wareId,consId:c.get("consId"),consNo:c.get("consNo"),wareVessel:c.get("vessName"),wareVoyage:c.get("voyaName"),wareMblNo:c.get("consMblNo"),wareVendorId:c.get("consWarehouse"),wareVendorName:c.get("consWarehouseName"),wareVendorContact:c.get("consWarehouseContact"),wareVendorTel:c.get("consWarehouseTel"),wareVendorFax:c.get("consWarehouseFax"),wareCustomerContact:c.get("custContact"),wareCustomerTel:c.get("custTel"),wareCustomerFax:c.get("custFax"),wareOperator:"",wareOperatorTel:getCFG("COMPANY_TEL"),wareOperatorFax:getCFG("COMPANY_FAX"),wareType:"I",wareDate:new Date(),wareBookDate:new Date(),wareAcceptDate:new Date(),wareTransVendor:c.get("consTrackVendor"),wareTransVendorName:c.get("consTrackVendorName"),wareLoadFlag:0,wareTrackNo:"",wareContainerNo:c.get("consContainerNo"),wareRemarks:c.get("consWarehouseRemarks"),wareAcceptStatus:0,version:0});this.store.insert(0,m);m.set("rowAction","N");this.resel=true;this.wareGrid.getSelectionModel().selectFirstRow()};this.removeWare=function(){var m=this.wareGrid.getSelectionModel().getSelected();if(m){if(m.get("wareAcceptStatus")!=0){XMG.alert(SYS,M_WARE_CONFIRMED)}else{m.set("rowAction",m.get("rowAction")=="N"?"D":"R");this.store.remove(m);this.getForm().reset();var p=this.cargoGrid.getStore();var n=p.getRange();for(var o=0;o<n.length;o++){n[o].set("rowAction",n[o].get("rowAction")=="N"?"D":"R");this.cargoStore.remove(n[o]);p.remove(n[o])}}}else{XMG.alert(SYS,M_R_P)}};this.save=function(){this.wareGrid.stopEditing();this.cargoGrid.stopEditing();var n=this.wareGrid.getSelectionModel().getSelected();if(n){n.beginEdit();this.getForm().updateRecord(n);n.endEdit()}var q="";var p=this.store.getModifiedRecords();if(p.length>0){q=ATX(p,"FWarehouse",FWarehouse)}var s=[];var o=this.cargoStore.getRange();for(var r=0;r<o.length;r++){if(o[r].dirty){s[s.length]=o[r]}}if(s.length>0){var m=ATX(s,"FWarehouseCargo",FWarehouseCargo);q=q+m}if(q!=""){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"WARE_S"},success:function(v){var u=XTRA(v.responseXML,"FWarehouse",FWarehouse);FOSU(this.store,u,FWarehouse);var t=XTRA(v.responseXML,"FWarehouseCargo",FWarehouseCargo);FOSU(this.cargoStore,t,FWarehouseCargo);XMG.alert(SYS,M_S)},failure:function(t){XMG.alert(SYS,M_F+t.responseText)},xmlData:FOSX(q)})}};this.expExcel=function(){var m=this.wareGrid.getSelectionModel().getSelected();if(m){EXPC("WARE","&wareId="+m.get("wareId"))}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.expEmail=function(){var m=this.wareGrid.getSelectionModel().getSelected();if(m){var q="";var p="";var n="";var o="";EXPM(q,p,n,o,"WARE","wareId="+m.get("wareId"))}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};var i=function(n){var m=this.wareGrid.getSelectionModel().getSelected();if(m){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"WARE_U",wareId:m.get("wareId"),wareStatus:n},success:function(o){m.set("wareStatus",n);this.updateToolbar();XMG.alert(SYS,M_S)},failure:function(o){XMG.alert(SYS,M_F+o.responseText)}})}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.start=function(){i("1")};this.end=function(){i("2")};var e=getRM(c.get("consBizClass"),c.get("consBizType"),c.get("consShipType"))+M3_WARE;this.updateToolbar=function(){var m=this.wareGrid.getSelectionModel().getSelected();var n=this.getTopToolbar();var o=m.get("wareStatus");if(m){n.getComponent("TB_A").setDisabled(NR(e+F_M));n.getComponent("TB_B").setDisabled(NR(e+F_R)||o!="0");n.getComponent("TB_C").setDisabled(NR(e+F_M))}};var d=CREATE_E_MENU(C_WARE_BILL,this.expExcel,this.expEmail,function(){},this);new Ext.KeyMap(Ext.getDoc(),{key:"nrse",ctrl:true,handler:function(n,o){var m=T_MAIN.getComponent("C_"+c.get("id"));if(m&&m==T_MAIN.getActiveTab()){var p=m.getComponent("T_WARE_"+c.get("id"));if(p==m.getActiveTab()){switch(n){case Ext.EventObject.N:if(!NR(e+F_M)){this.addWare()}break;case Ext.EventObject.R:if(!NR(e+F_R)){this.removeWare()}break;case Ext.EventObject.S:if(!NR(e+F_M)){this.save()}break;case Ext.EventObject.E:if(!NR(e+F_M)){this.expExcel()}break}}}},stopEvent:true,scope:this});Fos.WarehouseTab.superclass.constructor.call(this,{id:"T_WARE_"+c.get("id"),title:C_SR_WARE+"(F5)",header:false,deferredRender:false,autoScroll:true,labelAlign:"right",labelWidth:90,bodyStyle:"padding:0px 0px 0px",border:true,layout:"border",tbar:[{text:C_ADD+"(N)",itemId:"TB_A",iconCls:"add",disabled:NR(e+F_M),scope:this,handler:this.addWare},"-",{text:C_REMOVE+"(R)",itemId:"TB_B",iconCls:"remove",disabled:NR(e+F_R),scope:this,handler:this.removeWare},"-",{text:C_SAVE+"(S)",itemId:"TB_C",iconCls:"save",disabled:NR(e+F_M),scope:this,handler:this.save},"-",{text:C_EXPORT+"(E)",iconCls:"print",disabled:NR(e+F_E),scope:this,menu:{items:[d]}}],items:[{layout:"fit",region:"north",title:C_WARE_LIST,border:false,height:150,collapsible:true,items:[this.wareGrid]},{xtype:"tabpanel",region:"center",plain:true,activeTab:0,defaults:{bodyStyle:"padding:0px"},listeners:{scope:this,tabchange:function(n,o){o.doLayout()}},items:[{layout:"column",title:C_WARE_INFO,tabIndex:1,layoutConfig:{columns:4},deferredRender:false,collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_NO,name:"wareNo",tabIndex:5,xtype:"textfield",anchor:"95%"},{fieldLabel:C_WAREHOUSE,name:"wareVendorName",tabIndex:9,store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();c.set("wareVendorId","");c.set("wareVendorName","")}},select:function(p,o,n){this.find("name","wareVendorContact")[0].setValue(o.get("custContact"));this.find("name","wareVendorTel")[0].setValue(o.get("custTel"));this.find("name","wareVendorFax")[0].setValue(o.get("custFax"));var m=this.wareGrid.getSelectionModel().getSelected();if(m){m.set("wareVendorId",o.get("custId"));m.set("wareVendorContact",o.get("custContact"));m.set("wareVendorTel",o.get("custTel"))}},keydown:{fn:function(m,n){LC(m,n,"custWarehouseFlag")},buffer:BF}}},{fieldLabel:C_WARE_ACCEPT_STATUS,name:"wareAcceptStatus",tabIndex:17,store:WAST_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"},{fieldLabel:C_WARE_ACCEPT_TIME,name:"wareAcceptDate",tabIndex:14,xtype:"datefield",format:DATEF,anchor:"95%"},{fieldLabel:C_VESS,name:"wareVessel",tabIndex:5,xtype:"textfield",anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_TYPE,name:"wareType",tabIndex:2,xtype:"textfield",store:WATY_S,xtype:"combo",displayField:"NAME",valueField:"CODE",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"},{fieldLabel:C_WARE_CONTACT,name:"wareVendorContact",tabIndex:6,xtype:"textfield",anchor:"95%"},{fieldLabel:C_CUST_CONTACT,name:"wareCustomerContact",tabIndex:10,xtype:"textfield",anchor:"95%"},{fieldLabel:C_WARE_OPERATOR,name:"wareOperator",tabIndex:13,store:getUSER_S(),xtype:"combo",displayField:"userLoginName",valueField:"userId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"},{fieldLabel:C_VOYA,name:"wareVoyage",tabIndex:5,xtype:"textfield",anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_DATE,name:"wareDate",tabIndex:3,xtype:"datefield",format:DATEF,anchor:"95%"},{fieldLabel:C_WARE_TEL,name:"wareVendorTel",tabIndex:7,xtype:"textfield",anchor:"95%"},{fieldLabel:C_CUST_TEL,name:"wareCustomerTel",tabIndex:11,xtype:"textfield",anchor:"95%"},{fieldLabel:C_WARE_OPERATOR_TEL,name:"wareOperatorTel",tabIndex:11,xtype:"textfield",anchor:"95%"},{fieldLabel:C_BL_NO,name:"wareMblNo",tabIndex:5,xtype:"textfield",anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_WARE_BOOK_DATE,name:"wareBookDate",tabIndex:4,xtype:"datefield",format:DATEF,anchor:"90%"},{fieldLabel:C_WARE_FAX,name:"wareVendorFax",tabIndex:8,xtype:"textfield",anchor:"90%"},{fieldLabel:C_CUST_FAX,name:"wareCustomerFax",tabIndex:12,xtype:"textfield",anchor:"90%"},{fieldLabel:C_WARE_OPERATOR_FAX,name:"wareOperatorFax",tabIndex:16,xtype:"textfield",anchor:"90%"},{fieldLabel:C_WARE_LOAD_FLAG,name:"wareLoadFlag",tabIndex:20,xtype:"checkbox",anchor:"60%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_TRACK_VENDOR,name:"wareTransVendorName",tabIndex:17,store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:C_LW,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(m){if(m.getRawValue()==""){m.clearValue();c.set("wareTransVendor","");c.set("wareTransVendorName","")}},select:function(p,o,n){var m=this.wareGrid.getSelectionModel().getSelected();if(m){m.set("wareTransVendor",o.get("custId"))}},keydown:{fn:function(m,n){LC(m,n,"custTrackFlag")},buffer:BF}}}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_TRACK_NO,name:"wareTrackNo",tabIndex:18,xtype:"textfield",anchor:"90%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_CONT_NO,name:"wareContainerNo",tabIndex:19,xtype:"textarea",anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_REMARKS,name:"wareRemarks",tabIndex:20,xtype:"textarea",anchor:"90%"}]}]},{layout:"fit",border:false,collapsible:true,title:C_CARGO_LIST,items:[this.cargoGrid]}]}]})};Ext.extend(Fos.WarehouseTab,Ext.FormPanel);Fos.ContainerTab=function(b){this.sel=GSEL;this.store=GS("CONT_Q","FContainer",FContainer,"contId","DESC","","","id",false);this.cargoStore=GS("COCA_Q","FContainerCargo",FContainerCargo,"cocaId","DESC","","","id",false);if(b.get("rowAction")!="N"){this.store.load({params:{consId:b.get("consId"),contPreFlag:"N"},scope:this,callback:function(m,p,n){if(n){this.reCalculate()}}});this.cargoStore.load({params:{consId:b.get("consId")}})}var c=new Ext.form.TextField({width:80,disabled:true});var i=new Ext.form.TextField({width:80,disabled:true});var g=new Ext.form.TextField({width:80,disabled:true});this.reCalculate=function(){var n=0;var q=0;var p=0;var m=this.store.getRange();for(var o=0;o<m.length;o++){if(m[o].get("contPackageNum")){n=n+parseFloat(m[o].get("contPackageNum"))}if(m[o].get("contGrossWeight")){q=q+parseFloat(m[o].get("contGrossWeight"))}if(m[o].get("contMeasurement")){p=p+parseFloat(m[o].get("contMeasurement"))}}c.setValue(round2(n));i.setValue(round2(q));g.setValue(round2(p))};this.calContainer=function(){var n=0;var s=0;var q=0;var m=this.cargoGrid.getStore().getRange();for(var o=0;o<m.length;o++){if(m[o].get("cocaPackageNum")>0){n=n+parseFloat(m[o].get("cocaPackageNum"))}if(m[o].get("cocaGrossWeight")>0){s=s+parseFloat(m[o].get("cocaGrossWeight"))}if(m[o].get("cocaMeasurement")>0){q=q+parseFloat(m[o].get("cocaMeasurement"))}}var p=this.grid.getSelectionModel().getSelected();if(n>0){p.set("contPackageNum",round2(n))}if(s>0){p.set("contGrossWeight",round2(s))}if(q>0){p.set("contMeasurement",round2(q))}};this.autoShip=function(){};var l={scope:this,rowselect:function(r,q,n){if(this.sel!=n.get("contId")){this.sel=n.get("contId");var p=this.cargoGrid.getStore();p.removeAll();var m=this.cargoStore.getRange();for(var o=0;o<m.length;o++){if(m[o].get("contId")==this.sel&&m[o].get("rowAction")!="D"&&m[o].get("rowAction")!="R"){p.add(m[o])}}}}};var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true,scope:this,listeners:l});var a=new Ext.grid.CheckColumn({header:"SOC",dataIndex:"contSocFlag",width:55});var j=new Ext.grid.ColumnModel({columns:[f,{header:C_CONT_NO,dataIndex:"contNo",width:80,validator:checkContainerNo,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:"集装箱编码格式不正确，前四位应为字母，后七位为数字，请重新输入！"})},{header:C_SEAL_NO,dataIndex:"contSealNo",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_COTY,dataIndex:"cotyId",width:60,renderer:getCOTY,editor:new Ext.form.ComboBox({displayField:"cotyCode",valueField:"cotyId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getCOTY_S()})},{header:C_FL,dataIndex:"contFl",width:40,editor:new Ext.form.ComboBox({displayField:"CODE",valueField:"CODE",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:FL_S})},a,{header:C_CARGO_NAME_EN,dataIndex:"contCargoNameEn",width:100,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_PACKAGES,dataIndex:"contPackageNum",width:60,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_PACK,dataIndex:"packId",width:80,renderer:getPACK,editor:new Ext.form.ComboBox({displayField:"packName",valueField:"packId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getPACK_S(),listeners:{scope:this,select:function(o,n,m){this.grid.getSelectionModel().getSelected().set("packName",n.get("packName"))}}})},{header:C_GW,dataIndex:"contGrossWeight",width:60,renderer:rateRender,editor:new Ext.form.TextField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_CBM,dataIndex:"contMeasurement",width:60,renderer:rateRender,editor:new Ext.form.TextField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_REMARKS,dataIndex:"contRemarks",width:100,editor:new Ext.form.TextField()}],defaults:{sortable:true,width:100}});this.grid=new Ext.grid.EditorGridPanel({title:C_CONT_LIST,border:true,plugins:a,autoScroll:true,clicksToEdit:1,height:200,store:this.store,sm:f,cm:j,listeners:{scope:this,afteredit:function(n){var m=n.field;if(m=="contPackageNum"||m=="contGrossWeight"||m=="contMeasurement"){this.reCalculate()}}}});var k=new Ext.grid.CheckboxSelectionModel({singleSelect:false});var h=new Ext.grid.ColumnModel({columns:[k,{header:C_BL_NO,dataIndex:"consMblNo",width:80,editor:new Ext.form.TextField({allowBlank:false,blankText:"",invalidText:""})},{header:C_MARKS,dataIndex:"cocaMarks",width:80,editor:new Ext.form.TextField({})},{header:C_CARGO_NAME_EN,dataIndex:"cocaCargoName",width:80,editor:new Ext.form.TextField({})},{header:C_PACKAGES,dataIndex:"cocaPackageNum",width:60,editor:new Ext.form.NumberField({allowBlank:false})},{header:C_PACK,dataIndex:"packName",width:80,renderer:getPACK,editor:new Ext.form.ComboBox({displayField:"packName",valueField:"packName",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getPACK_S(),listeners:{scope:this,select:function(o,n,m){this.cargoGrid.getSelectionModel().getSelected().set("packName",n.get("packName"))}}})},{header:C_GW,dataIndex:"cocaGrossWeight",width:60,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})},{header:C_CBM,dataIndex:"cocaMeasurement",width:60,renderer:rateRender,editor:new Ext.form.NumberField({decimalPrecision:4,allowBlank:false,blankText:"",invalidText:""})}],defaults:{sortable:true,width:120}});this.addCargo=function(){var m=this.grid.getSelectionModel().getSelected();if(m){var n=new Fos.CargoLookupWin(b.get("consShipType")=="FCL"?"CARG_Q":"CARG_MID_Q",b.get("consId"));n.addButton({text:C_OK,scope:this,handler:function(){var s=n.findById("G_CARG_LOOKUP");var o=s.getSelectionModel().getSelections();if(o){for(var q=0;q<o.length;q++){if(this.cargoGrid.getStore().findBy(function(t,u){return t.get("cargId")==o[q].get("cargId")})==-1){var r=GGUID();var p=new FContainerCargo({id:r,cocaId:r,contId:m.get("contId"),consId:b.get("consId"),consNo:b.get("consNo"),cargId:o[q].get("cargId"),consMblNo:b.get("consMblNo"),consHbl:b.get("consHbl"),consCustName:"",cocaMarks:o[q].get("cargMarks"),cocaCargoName:o[q].get("cargNameEn"),packId:o[q].get("packId"),packName:getPACK(o[q].get("packId")),cocaPackageNum:o[q].get("cargPackageNum"),cocaGrossWeight:o[q].get("cargGrossWeight"),cocaMeasurement:o[q].get("cargMeasurement"),compCode:"",verson:0});this.cargoStore.add(p);p.set("rowAction","N");this.cargoGrid.getStore().add(p);if(o[q].get("cargReeterFlag")){m.set("cargTemperature",o[q].get("cargTemperature"))}if(o[q].get("cargDanagerFlag")){m.set("cargDanagerClass",o[q].get("cargDanagerClass"));m.set("cargUnNo",o[q].get("cargUnNo"));m.set("cargImdgPage",o[q].get("cargImdgPage"));m.set("cargFlashPoint",o[q].get("cargFlashPoint"))}}}this.calContainer();this.reCalculate()}n.close()}},this);n.addButton({text:C_CANCEL,handler:function(){n.close()}},this);n.show()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.removeCargo=function(){var n=this.cargoGrid.getSelectionModel().getSelections();if(n.length){for(var m=0;m<n.length;m++){n[m].set("rowAction",n[m].get("rowAction")=="N"?"D":"R");this.cargoGrid.getStore().remove(n[m])}this.calContainer();this.reCalculate()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.cargoGrid=new Ext.grid.EditorGridPanel({title:C_CONT_SHIP_LIST,border:true,autoScroll:true,sm:k,cm:h,store:new Ext.data.Store({reader:new Ext.data.XmlReader({id:"cocaId",record:"FContainerCargo"},FContainerCargo),sortInfo:{field:"cocaId",direction:"ASC"}}),listeners:{scope:this,afteredit:function(n){var m=n.field;if(m=="cocaPackageNum"||m=="cocaGrossWeight"||m=="cocaMeasurement"){this.calContainer();this.reCalculate()}}},tbar:[{text:C_ADD+"(A)",iconCls:"add",scope:this,handler:this.addCargo},"-",{text:C_REMOVE+"(D)",iconCls:"remove",scope:this,handler:this.removeCargo},"-"]});this.addCont=function(){var m=GGUID();var n=new FContainer({id:m,contId:m,consId:b.get("consId"),consNo:b.get("consNo"),contPreFlag:"N",contPartOfFlag:"N",consMblNo:b.get("consMblNo"),consHblNo:b.get("consHblNo"),contMConsId:b.get("consId"),contNum:1,contVessel:b.get("vessName"),contVoyage:b.get("voyaName"),contPol:b.get("consPolEn"),contPod:b.get("consPodEn"),contDeliveryPlace:b.get("consDeliveryPlace"),contMConsNo:b.get("consNo"),contMMblNo:b.get("consMblNo"),contHBlNo:b.get("consHblNo"),contNo:"",contSealNo:"",cotyId:"",contFl:"FCL",packId:"",contPackageNum:"",contCargoNameEn:"",contGrossWeight:"",contMeasurement:"",contSocFlag:"0",contLoadDate:new Date(),contRemarks:"",version:"0",rowAction:"N"});this.store.insert(0,n);this.grid.getSelectionModel().selectFirstRow();this.grid.startEditing(0,1)};this.removeCont=function(){var m=this.grid.getSelectionModel().getSelected();if(m){m.set("rowAction",m.get("rowAction")=="N"?"D":"R");this.store.remove(m);var p=this.cargoGrid.getStore();var n=p.getRange();for(var o=0;o<n.length;o++){n[o].set("rowAction",n[o].get("rowAction")=="N"?"D":"R");this.cargoStore.remove(n[o]);p.remove(n[o])}this.reCalculate()}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.save=function(){this.grid.stopEditing();this.cargoGrid.stopEditing();var n=this.store.getModifiedRecords();if(n.length){var o=ATX(n,"FContainer",FContainer)}var p=getDirty(this.cargoStore);if(p.length>0){var m=ATX(p,"FContainerCargo",FContainerCargo);o=o+m}if(o!=""){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONT_S"},success:function(s){var r=XTRA(s.responseXML,"FContainerCargo",FContainerCargo);FOSU(this.cargoStore,r,FContainerCargo);var q=XTRA(s.responseXML,"FContainer",FContainer);FOSU(this.store,q,FContainer);XMG.alert(SYS,M_S)},failure:function(q){XMG.alert(SYS,M_F+q.responseText)},xmlData:FOSX(o)})}else{XMG.alert(SYS,M_NC)}};this.expExcel=function(){var m=this.grid.getSelectionModel().getSelected();if(m){m.beginEdit();this.getForm().updateRecord(m);m.endEdit();if(m.dirty){XMG.alert(SYS,M_DIRTY_PROMPT);return}else{EXPC("CONT","&contId="+m.get("contId"))}}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.expEmail=function(){var m=this.grid.getSelectionModel().getSelected();if(m){var q=b.get("custEmail");var p="";var n="";var o="";EXPM(q,p,n,o,"CONT","contId="+m.get("contId"))}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};var e=getRM(b.get("consBizClass"),b.get("consBizType"),b.get("consShipType"))+M3_CONT;var d=CREATE_E_MENU(C_CONT_BILL,this.expExcel,this.expEmail,function(){},this);new Ext.KeyMap(Ext.getDoc(),{key:"nrsead",ctrl:true,handler:function(n,o){var m=T_MAIN.getComponent("C_"+b.get("id"));if(m&&m==T_MAIN.getActiveTab()){var p=m.getComponent("T_CONT_"+b.get("id"));if(p==m.getActiveTab()){switch(n){case Ext.EventObject.N:if(!NR(e+F_M)){this.addCont()}break;case Ext.EventObject.R:if(!NR(e+F_R)){this.removeCont()}break;case Ext.EventObject.S:if(!NR(e+F_M)){this.save()}break;case Ext.EventObject.E:if(!NR(e+F_M)){this.expExcel()}break;case Ext.EventObject.A:if(!NR(e+F_M)){this.addCargo()}break;case Ext.EventObject.D:if(!NR(e+F_R)){this.removeCargo()}break}}}},stopEvent:true,scope:this});Fos.ContainerTab.superclass.constructor.call(this,{id:"T_CONT_"+b.get("id"),title:C_SR_CONT+"(F6)",border:true,autoScroll:true,header:false,deferredRender:false,autoScroll:true,labelAlign:"right",labelWidth:80,bodyStyle:"padding:0px 0px 10px",border:true,layout:"border",tbar:[{text:C_ADD+"(N)",iconCls:"add",disabled:NR(e+F_M),scope:this,handler:this.addCont},"-",{text:C_REMOVE+"(R)",iconCls:"remove",disabled:NR(e+F_R),scope:this,handler:this.removeCont},"-",{text:C_SAVE+"(S)",iconCls:"save",disabled:NR(e+F_M),scope:this,handler:this.save},"-",{text:C_EXPORT+"(E)",iconCls:"print",disabled:NR(e+F_E),scope:this,menu:{items:[d]}},"->",{xtype:"tbtext",text:C_SUM_PACK},c,"-",{xtype:"tbtext",text:C_SUM_GW},i,"-",{xtype:"tbtext",text:C_SUM_CBM},g],items:[{layout:"fit",region:"north",height:200,border:false,items:this.grid},{layout:"fit",region:"center",border:false,items:this.cargoGrid}]})};Ext.extend(Fos.ContainerTab,Ext.FormPanel);Fos.SecondShipTab=function(d){this.sel=GSEL;this.store=GS("SESH_Q","FSecondShip",FSecondShip,"seshId","DESC","","","id",false);if(d.get("rowAction")!="N"){this.store.load({params:{consId:d.get("consId")}})}var c={scope:this,rowselect:function(h,g,f){if(this.sel!=f.get("id")){this.sel=f.get("id");this.getForm().reset();this.getForm().loadRecord(f)}},rowdeselect:function(h,g,f){if(this.getForm().isDirty()){f.beginEdit();this.getForm().updateRecord(f);f.endEdit()}}};var e=new Ext.grid.CheckboxSelectionModel({singleSelect:true,scope:this,listeners:c});var b=new Ext.grid.ColumnModel({columns:[e,{header:C_BL_NO,dataIndex:"seshBlNo"},{header:C_SECOND_CARRIER,dataIndex:"seshCarrier",width:40},{header:C_SECOND_VESS,dataIndex:"seshVessel"},{header:C_SECOND_VOYA,dataIndex:"seshVoyage"},{header:C_POT,dataIndex:"seshPot"},{header:C_ETA,dataIndex:"seshEta",renderer:formatDate},{header:C_ETD,dataIndex:"seshEtd",renderer:formatDate}],defaults:{sortable:true,width:80}});this.grid=new Ext.grid.GridPanel({title:C_SECOND_SHIP_LIST,border:true,autoScroll:true,height:150,store:this.store,sm:e,cm:b});this.addSesh=function(){var f=new FSecondShip({id:GGUID(),seshId:"0",consId:d.get("consId"),consNo:d.get("consNo"),seshPot:d.get("consPotEn"),rowAction:"N"});this.store.insert(0,f);this.grid.getSelectionModel().selectFirstRow()};this.removeSesh=function(){var f=this.grid.getSelectionModel().getSelected();if(f){f.set("rowAction",f.get("rowAction")=="N"?"D":"R");this.store.remove(f)}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.save=function(){this.grid.stopEditing();var f=this.grid.getSelectionModel().getSelected();if(f){f.beginEdit();this.getForm().updateRecord(f);f.endEdit()}var g=this.store.getModifiedRecords();if(g.length){var h=ATX(g,"FSecondShip",FSecondShip)}if(h!=""){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"SESH_S"},success:function(j){var i=XTRA(j.responseXML,"FSecondShip",FSecondShip);FOSU(this.store,i,FSecondShip);XMG.alert(SYS,M_S)},failure:function(i){XMG.alert(SYS,M_F+i.responseText)},xmlData:FOSX(h)})}};var a=getRM(d.get("consBizClass"),d.get("consBizType"),d.get("consShipType"))+M3_SESH;new Ext.KeyMap(Ext.getDoc(),{key:"nrs",ctrl:true,handler:function(g,h){var f=T_MAIN.getComponent("C_"+d.get("id"));if(f&&f==T_MAIN.getActiveTab()){var i=f.getComponent("T_SESH_"+d.get("id"));if(i==f.getActiveTab()){switch(g){case Ext.EventObject.N:if(!NR(a+F_M)){this.addSesh()}break;case Ext.EventObject.R:if(!NR(a+F_R)){this.removeSesh()}break;case Ext.EventObject.S:if(!NR(a+F_M)){this.save()}break}}}},stopEvent:true,scope:this});Fos.SecondShipTab.superclass.constructor.call(this,{id:"T_SESH_"+d.get("id"),title:C_SECOND_SHIP+"(F11)",header:false,deferredRender:false,autoScroll:true,labelAlign:"right",labelWidth:80,bodyStyle:"padding:0px 0px 0px",border:true,trackResetOnLoad:true,tbar:[{text:C_ADD+"(N)",iconCls:"add",disabled:NR(a+F_M),scope:this,handler:this.addSesh},"-",{text:C_REMOVE+"(R)",iconCls:"remove",disabled:NR(a+F_R),scope:this,handler:this.removeSesh},"-",{text:C_SAVE+"(S)",iconCls:"save",disabled:NR(a+F_M),scope:this,handler:this.save}],items:[{layout:"fit",border:false,items:[this.grid]},{layout:"column",title:C_SECOND_SHIP_INFO,layoutConfig:{columns:4},items:[{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_BL_NO,name:"seshBlNo",tabIndex:1,xtype:"textfield",anchor:"90%"},{fieldLabel:C_POT_AGENCY,name:"seshPotAgency",tabIndex:5,xtype:"textfield",anchor:"90%"},{fieldLabel:C_TRANS_NO,name:"seshTransNo",tabIndex:9,xtype:"textfield",anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_SECOND_CARRIER,name:"seshCarrier",tabIndex:2,xtype:"textfield",anchor:"90%"},{fieldLabel:C_POT,name:"seshPot",tabIndex:6,xtype:"textfield",anchor:"90%"},{fieldLabel:C_CUSTOM_SNO,name:"seshSealNo",tabIndex:10,xtype:"textfield",anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_SECOND_VESS,name:"seshVessel",tabIndex:3,xtype:"textfield",anchor:"90%"},{fieldLabel:C_ETA,name:"seshEta",tabIndex:7,xtype:"datefield",format:DATEF,anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_SECOND_VOYA,name:"seshVoyage",tabIndex:4,xtype:"textfield",anchor:"90%"},{fieldLabel:C_ETD,name:"seshEtd",tabIndex:8,xtype:"datefield",format:DATEF,anchor:"90%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_REMARKS,name:"seshRemarks",tabIndex:11,xtype:"textfield",anchor:"90%"}]}]}]})};Ext.extend(Fos.SecondShipTab,Ext.FormPanel);Fos.BBookingTab=function(b){this.save=function(){var h=FConsign.prototype.fields;for(var d=0;d<h.keys.length;d++){var g=""+h.keys[d];var e=this.find("name",g);if(e!=undefined&&e.length>0){b.set(g,e[0].getValue())}}if(b.get("consStatusBBook")==0){b.set("consStatusBBook","1")}var c=RTX(b,"FConsign",FConsign);Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONS_S"},success:function(f){var i=XTR(f.responseXML,"FConsign",FConsign);b.set("version",i.get("version"));this.updateToolBar("1");XMG.alert(SYS,M_S)},failure:function(f){XMG.alert(SYS,M_F+f.responseText)},xmlData:FOSX(c)})};this.cancel=function(){this.updateStatus("4")};this.renew=function(){this.updateStatus("1")};this.check=function(){this.updateStatus("5")};this.exit=function(){this.updateStatus("6")};this.updateStatus=function(c){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"CONS_U",consId:b.get("consId"),consStatus:c},success:function(d){b.set("consStatusBBook",c);this.updateToolBar(c);XMG.alert(SYS,M_S)},failure:function(d){XMG.alert(SYS,M_F+d.responseText)}})};this.updateToolBar=function(d){var c=this.getTopToolbar();c.getComponent("TB_S").setDisabled(d>"5");c.getComponent("TB_C").setDisabled(d>="4");c.getComponent("TB_F").setDisabled(d!="1");c.getComponent("TB_N").setDisabled(d!="4");c.getComponent("TB_Q").setDisabled(d!="5");c.getComponent("TB_M").setText(C_STATUS_C+getBOST(d))};this.expExcel=function(){EXPC("BBOOK","&consId="+b.get("consId"))};this.expEmail=function(){var f="";var e="";var c=C_B_BOOKING_DOC;var d="";EXPM(f,e,c,d,"BBOOK","consId="+b.get("consId"))};var a=getRM(b.get("consBizClass"),b.get("consBizType"),b.get("consShipType"))+M3_BBOOK;new Ext.KeyMap(Ext.getDoc(),{key:"sfrqte",ctrl:true,handler:function(d,f){var c=T_MAIN.getComponent("C_"+b.get("id"));if(c&&c==T_MAIN.getActiveTab()){var g=c.getComponent("T_BBOOK_"+b.get("id"));if(g==c.getActiveTab()){switch(d){case Ext.EventObject.S:if(!NR(a+F_M)){this.save()}break;case Ext.EventObject.F:if(!NR(a+F_R)){this.cancel()}break;case Ext.EventObject.R:if(!NR(a+F_M)){this.renew()}break;case Ext.EventObject.Q:if(!NR(a+F_M)){this.check()}break;case Ext.EventObject.T:if(!NR(a+F_M)){this.exit()}break;case Ext.EventObject.E:if(!NR(a+F_M)){this.expExcel()}break}}}},stopEvent:true,scope:this});Fos.BBookingTab.superclass.constructor.call(this,{id:"T_BBOOK_"+b.get("id"),title:C_SR_BBOOK+"(F10)",header:false,deferredRender:false,autoScroll:true,labelAlign:"right",labelWidth:70,bodyStyle:"padding:0px 0px 0px",border:false,width:800,tbar:[{text:C_SAVE+"(S)",itemId:"TB_S",iconCls:"save",disabled:NR(a+F_M)||b.get("consStatusBBook")>"4",scope:this,handler:this.save},"-",{text:C_BOOK_FAILED+"(F)",itemId:"TB_F",iconCls:"cancel",disabled:NR(a+F_M)||b.get("consStatusBBook")!="1",scope:this,handler:this.cancel},"-",{text:C_BOOK_RENEW+"(R)",itemId:"TB_N",iconCls:"renew",disabled:NR(a+F_M)||b.get("consStatusBBook")!="4",scope:this,handler:this.renew},"-",{text:C_BOOK_CONFIRM+"(Q)",itemId:"TB_C",iconCls:"check",disabled:NR(a+F_M)||b.get("consStatusBBook")>="4",scope:this,handler:this.check},"-",{text:C_BOOK_EXIT+"(T)",itemId:"TB_Q",iconCls:"exit",disabled:NR(a+F_M)||b.get("consStatusBBook")!="5",scope:this,handler:this.exit},"-",{text:C_EXPORT+"(E)",iconCls:"print",disabled:NR(a+F_E),scope:this,menu:{items:[{text:C_B_BOOKING_DOC,menu:{items:[{text:"Excel",scope:this,handler:this.expExcel},{text:C_EMAIL,scope:this,handler:this.expEmail},{text:C_FAX,scope:this,handler:function(){}}]}}]}},"->",{itemId:"TB_M",disabled:true,text:C_STATUS_C+getBOST(b.get("consStatusBBook"))},"-"],items:[{layout:"column",layoutConfig:{columns:4},deferredRender:false,title:C_BASE_INFO,collapsible:true,labelWidth:80,items:[{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_CARRIER,name:"consBCarrier",tabIndex:1,value:b.get("consBCarrier"),store:getCS(),enableKeyEvents:true,tpl:custTpl,itemSelector:"div.list-item",listWidth:250,xtype:"combo",displayField:"custCode",valueField:"custNameCn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(c){if(c.getRawValue()==""){c.clearValue();b.set("consBCarrierId","");b.set("consBCarrier","")}},select:function(f,e,d){b.set("consBCarrierId",e.get("custId"))},keydown:{fn:function(c,d){LC(c,d,"custCarrierFlag")},buffer:BF}}},{fieldLabel:C_COUNTRY_D,name:"consBCountryD",disabled:true,tabIndex:5,value:b.get("consBCountryD"),store:getCOUN_S(),xtype:"combo",displayField:"counNameEn",valueField:"counCode",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%"},{fieldLabel:C_ETD,name:"consBEtd",tabIndex:9,value:b.get("consBEtd"),xtype:"datefield",format:DATEF,anchor:"95%"},{fieldLabel:C_BOOKING_NO,name:"consBBookingNo",tabIndex:13,value:b.get("consBBookingNo"),xtype:"textfield",anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_VESS,name:"consBVessel",tabIndex:2,value:b.get("consBVessel"),store:getVES(),enableKeyEvents:true,xtype:"combo",displayField:"vessNameEn",valueField:"vessNameEn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,blur:function(c){if(c.getRawValue()==""){c.clearValue();b.set("consBVesselId","");b.set("consBVessel","")}},select:function(f,e,d){b.set("consBVesselId",e.get("vessId"))},keydown:{fn:function(c,d){LV(c,d)},buffer:BF}}},{fieldLabel:C_POD,itemCls:"required",tabIndex:6,name:"consBPodEn",value:b.get("consBPodEn"),store:getPS(),xtype:"combo",displayField:"portNameEn",valueField:"portNameEn",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",tpl:portTpl,itemSelector:"div.list-item",listWidth:C_LW,enableKeyEvents:true,listeners:{scope:this,blur:function(c){if(c.getRawValue()==""){c.clearValue();b.set("consBPod","")}},select:function(f,e,d){b.set("consBPod",e.get("portId"));this.find("name","consBCountryD")[0].setValue(e.get("counCode"))},keydown:{fn:LP,buffer:BF}}},{fieldLabel:C_ETA,name:"consBEta",value:b.get("consBEta"),tabIndex:10,xtype:"datefield",format:DATEF,anchor:"95%"},{fieldLabel:C_BOOKING_DATE,name:"consBBookingDate",tabIndex:11,value:b.get("consStatusBBook")==0?(new Date()):b.get("consBBookingDate"),xtype:"datefield",format:DATEF,anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_VOYA,tabIndex:3,name:"consBVoyage",value:b.get("consBVoyage"),xtype:"textfield",anchor:"95%",listeners:{scope:this,select:function(f,e,d){b.set("consBVoyage",e.get("voyaName"))}}},{fieldLabel:C_POT,name:"consBPotEn",tabIndex:7,value:b.get("consBPotEn"),xtype:"textfield",anchor:"95%"},{fieldLabel:C_BHK_FLAG,tabIndex:11,name:"consBHkFlag",checked:b.get("consBHkFlag"),xtype:"checkbox",anchor:"50%"},{fieldLabel:C_REMARKS,name:"consBRemarks",tabIndex:12,value:b.get("consBRemarks"),xtype:"textfield",anchor:"95%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_POL,name:"consBPol",tabIndex:4,value:b.get("consBPol"),store:getPOL_S(),xtype:"combo",displayField:"portNameEn",valueField:"portId",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"95%",listeners:{scope:this,select:function(f,e,d){b.set("consBPolEn",e.get("portNameEn"))}}},{fieldLabel:C_DISCHARGE_HARBOUR,name:"consBHarbour",tabIndex:8,value:b.get("consBHarbour"),xtype:"textfield",anchor:"95%"},{fieldLabel:C_BINTERNATIONAL_FLAG,tabIndex:12,name:"consBInternationalFlag",checked:b.get("consBInternationalFlag"),xtype:"checkbox",anchor:"50%"}]}]},{layout:"column",layoutConfig:{columns:4},deferredRender:false,labelWidth:40,labelAlign:"top",title:C_SHIPPER_INFO,collapsible:true,items:[{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_SHIPPER,name:"consBShipper",tabIndex:17,value:b.get("consBShipper"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{fieldLabel:C_CONSIGNEE,name:"consBConsignee",tabIndex:18,value:b.get("consBConsignee"),xtype:"textarea",height:100,anchor:"95%"}]}]},{layout:"column",layoutConfig:{columns:6},deferredRender:false,labelWidth:80,height:300,labelAlign:"top",title:C_CARGO_INFO,collapsible:true,items:[{columnWidth:0.3,layout:"form",border:false,items:[{fieldLabel:C_MARKS,name:"consCargoMarks",tabIndex:21,value:b.get("consCargoMarks"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.3,layout:"form",border:false,items:[{fieldLabel:C_CARGO_DESC,name:"consCargoDesc",tabIndex:19,value:b.get("consCargoDesc"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.1,layout:"form",border:false,items:[{fieldLabel:C_NUM_PACK,name:"consCargoPackages",tabIndex:20,value:b.get("consCargoPackages"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.1,layout:"form",border:false,items:[{fieldLabel:C_NW,name:"consCargoNetWeight",tabIndex:22,value:b.get("consCargoNetWeight"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.1,layout:"form",border:false,items:[{fieldLabel:C_GW,name:"consCargoGrossWeight",tabIndex:23,value:b.get("consCargoGrossWeight"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.1,layout:"form",border:false,items:[{fieldLabel:C_CBM,name:"consCargoMeasurement",tabIndex:24,value:b.get("consCargoMeasurement"),xtype:"textarea",height:100,anchor:"95%"}]},{columnWidth:0.6,layout:"form",border:false,items:[{fieldLabel:C_PACKAGES_EN,name:"consTotalPackagesInWord",tabIndex:25,value:b.get("consTotalPackagesInWord"),xtype:"textfield",anchor:"95%"}]},{columnWidth:0.14,layout:"form",border:false,items:[{fieldLabel:C_SUM_PACK,name:"consTotalPackages",tabIndex:26,value:b.get("consTotalPackages"),xtype:"numberfield",anchor:"95%"}]},{columnWidth:0.14,layout:"form",border:false,items:[{fieldLabel:C_SUM_GW,name:"consTotalGrossWeight",tabIndex:27,value:b.get("consTotalGrossWeight"),xtype:"numberfield",anchor:"95%"}]},{columnWidth:0.12,layout:"form",border:false,items:[{fieldLabel:C_SUM_CBM,name:"consTotalMeasurement",tabIndex:28,value:b.get("consTotalMeasurement"),xtype:"numberfield",anchor:"95%"}]}]}]})};Ext.extend(Fos.BBookingTab,Ext.FormPanel);Fos.RailwayBlTab=function(e){this.sel=GSEL;this.store=GS("RABL_Q","FRailwayBl",FRailwayBl,"rablId","DESC","","","id",false);if(e.get("rowAction")!="N"){this.store.load({params:{consId:e.get("consId")}})}var d={scope:this,rowselect:function(i,h,g){if(this.sel!=g.get("id")){this.sel=g.get("id");this.getForm().reset();this.getForm().loadRecord(g)}},rowdeselect:function(i,h,g){if(this.getForm().isDirty()){g.beginEdit();this.getForm().updateRecord(g);g.endEdit()}}};var c=new Ext.grid.CheckColumn({header:C_SOC,dataIndex:"rablSocFlag",width:55});var f=new Ext.grid.CheckboxSelectionModel({singleSelect:true,scope:this,listeners:d});var b=new Ext.grid.ColumnModel({columns:[f,{header:C_RABL_NO,dataIndex:"rablNo"},{header:C_CONT_NO,dataIndex:"rablContainerNo",width:40},{header:C_PACKAGES,dataIndex:"rablPackages"},{header:C_GW,dataIndex:"rablGrossWeight"},{header:C_TRAN_DATE,dataIndex:"rablEtd",renderer:formatDate},c],defaults:{sortable:true,width:80}});this.grid=new Ext.grid.GridPanel({title:C_RABL_LIST,border:true,autoScroll:true,plugins:[c],height:150,store:this.store,sm:f,cm:b});this.addRecord=function(){var g=new FRailwayBl({id:GGUID(),rablId:"0",consId:e.get("consId"),consNo:e.get("consNo"),custId:e.get("custId"),custName:e.get("custName")});this.store.insert(0,g);g.set("rowAction","N");this.grid.getSelectionModel().selectFirstRow()};this.removeRecord=function(){var g=this.grid.getSelectionModel().getSelected();if(g){g.set("rowAction",g.get("rowAction")=="N"?"D":"R");this.store.remove(g)}else{XMG.alert(SYS,M_NO_DATA_SELECTED)}};this.save=function(){this.grid.stopEditing();var g=this.grid.getSelectionModel().getSelected();if(g){g.beginEdit();this.getForm().updateRecord(g);g.endEdit()}var i="";var h=this.store.getModifiedRecords();if(h.length>0){i=ATX(h,"FRailwayBl",FRailwayBl)}if(i!=""){Ext.Ajax.request({scope:this,url:SERVICE_URL,method:"POST",params:{A:"RABL_S"},success:function(k){var j=XTRA(k.responseXML,"FRailwayBl",FRailwayBl);FOSU(this.store,j,FRailwayBl);XMG.alert(SYS,M_S)},failure:function(j){XMG.alert(SYS,M_F+j.responseText)},xmlData:FOSX(i)})}};var a=getRM(e.get("consBizClass"),e.get("consBizType"),e.get("consShipType"))+M3_RABL;new Ext.KeyMap(Ext.getDoc(),{key:"nrs",ctrl:true,handler:function(h,i){var g=T_MAIN.getComponent("C_"+e.get("id"));if(g&&g==T_MAIN.getActiveTab()){var j=g.getComponent("T_RABL_"+e.get("id"));if(j==g.getActiveTab()){switch(h){case Ext.EventObject.N:if(!NR(a+F_M)){this.addRecord()}break;case Ext.EventObject.R:if(!NR(a+F_R)){this.removeRecord()}break;case Ext.EventObject.S:if(!NR(a+F_M)){this.save()}break}}}},stopEvent:true,scope:this});Fos.RailwayBlTab.superclass.constructor.call(this,{id:"T_RABL_"+e.get("id"),title:C_RABL+"(F12)",header:false,deferredRender:false,autoScroll:true,labelAlign:"right",labelWidth:80,bodyStyle:"padding:0px 0px 0px",border:true,trackResetOnLoad:true,tbar:[{text:C_ADD+"(N)",iconCls:"add",disabled:NR(a+F_M),scope:this,handler:this.addRecord},"-",{text:C_REMOVE+"(R)",iconCls:"remove",disabled:NR(a+F_R),scope:this,handler:this.removeRecord},"-",{text:C_SAVE+"(S)",iconCls:"save",disabled:NR(a+F_M),scope:this,handler:this.save}],items:[{layout:"fit",border:false,items:[this.grid]},{layout:"column",title:C_BASE_INFO,layoutConfig:{columns:4},deferredRender:false,collapsible:true,items:[{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_RABL_NO,name:"rablNo",tabIndex:1,xtype:"textfield",anchor:"90%"},{fieldLabel:C_CONT_NO,name:"rablContainerNo",tabIndex:5,xtype:"textfield",anchor:"90%"},{fieldLabel:C_SEAL_NO+"1",name:"rablSealNo",tabIndex:9,xtype:"textfield",anchor:"90%"},{fieldLabel:C_PACKAGES,name:"rablPackages",tabIndex:13,xtype:"numberfield",anchor:"90%"},{fieldLabel:C_CONT_WEIGHT,name:"rablContainerWeight",tabIndex:17,xtype:"numberfield",anchor:"90%"},{fieldLabel:C_CONT_BACK_PLACE,name:"rablReturnPlace",tabIndex:21,xtype:"textfield",anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_CONTRACT_NO,name:"rablContractNo",tabIndex:2,xtype:"textfield",anchor:"90%"},{fieldLabel:C_COTY,name:"rablContainerType",tabIndex:6,xtype:"combo",displayField:"cotyCode",valueField:"cotyId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getCOTY_S(),anchor:"90%"},{fieldLabel:C_SEAL_NO+"2",name:"rablSealNo2",tabIndex:10,xtype:"textfield",anchor:"90%"},{fieldLabel:C_PACK,name:"packId",tabIndex:14,xtype:"combo",displayField:"packName",valueField:"packId",triggerAction:"all",mode:"local",selectOnFocus:true,listClass:"x-combo-list-small",store:getPACK_S(),anchor:"90%"},{fieldLabel:C_INVOICE_PRICE,name:"rablInvoicePrice",tabIndex:18,xtype:"numberfield",anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_TRAN_DATE,name:"rablEtd",tabIndex:3,xtype:"datefield",format:DATEF,anchor:"90%"},{fieldLabel:C_CONT_NO_ORI,name:"rablContainerNoO",tabIndex:7,xtype:"textfield",anchor:"90%"},{fieldLabel:C_HS_CODE,name:"rablHsCode",tabIndex:11,xtype:"textfield",anchor:"90%"},{fieldLabel:C_CARGO_WEIGHT,name:"rablGrossWeight",tabIndex:15,xtype:"numberfield",anchor:"90%"},{fieldLabel:C_CURR,tabIndex:19,name:"currCode",store:getCURR_S(),xtype:"combo",displayField:"currCode",valueField:"currCode",typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true,anchor:"90%"}]},{columnWidth:0.25,layout:"form",border:false,items:[{fieldLabel:C_BULK_FLAG,name:"rablBulkFlag",tabIndex:4,xtype:"checkbox",anchor:"50%"},{fieldLabel:C_SOC_FLAG,name:"rablSocFlag",tabIndex:8,xtype:"checkbox",anchor:"50%"},{fieldLabel:C_MARKS,name:"rablCargoMarks",tabIndex:12,xtype:"textfield",anchor:"90%"},{fieldLabel:C_CBM,name:"rablMeasurement",tabIndex:16,xtype:"numberfield",anchor:"90%"},{fieldLabel:C_CONT_AGENCY,name:"rablAgencyName",tabIndex:20,xtype:"textfield",anchor:"90%"}]}]},{layout:"column",title:C_RABL_INFO,layoutConfig:{columns:3},deferredRender:false,collapsible:true,labelAlign:"top",items:[{columnWidth:0.33,layout:"form",border:false,items:[{fieldLabel:C_SHIPPER,name:"rablShipper",tabIndex:22,xtype:"textarea",anchor:"90%"},{fieldLabel:C_SHIPPER_NOTES,name:"rablShipperNotes",tabIndex:25,xtype:"textarea",anchor:"90%"},{fieldLabel:C_STATION_T,name:"rablStationT",tabIndex:28,xtype:"textarea",anchor:"90%"},{fieldLabel:C_RA_CHARGE_REMARK,name:"rablChargeRemarks",tabIndex:31,xtype:"textarea",anchor:"90%"}]},{columnWidth:0.33,layout:"form",border:false,items:[{fieldLabel:C_CONSIGNEE,name:"rablConsignee",tabIndex:23,xtype:"textarea",anchor:"90%"},{fieldLabel:C_RA_NOTES,name:"rablRailwayNotes",tabIndex:26,xtype:"textarea",anchor:"90%"},{fieldLabel:C_STATION_D,name:"rablStationD",tabIndex:29,xtype:"textarea",anchor:"90%"},{fieldLabel:C_CARGO_NAME_EN,name:"rablCargoNameEn",tabIndex:32,xtype:"textarea",anchor:"90%"}]},{columnWidth:0.34,layout:"form",border:false,items:[{fieldLabel:C_NOTIFIER,name:"rablNotifyParty",tabIndex:24,xtype:"textarea",anchor:"90%"},{fieldLabel:C_DELIVERY_STATION,name:"rablDeliveryPlace",tabIndex:27,xtype:"textarea",anchor:"90%"},{fieldLabel:C_CONT_DESC,name:"rablContainerDesc",tabIndex:30,xtype:"textarea",anchor:"90%"},{fieldLabel:C_CARGO_NAME_CN,name:"rablCargoNameCn",tabIndex:33,xtype:"textarea",anchor:"90%"}]}]}]})};Ext.extend(Fos.RailwayBlTab,Ext.FormPanel);